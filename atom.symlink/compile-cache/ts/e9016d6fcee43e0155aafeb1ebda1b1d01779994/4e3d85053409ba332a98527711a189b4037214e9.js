////////////////////////////////// MAGIC
var vm = require('vm');
var fs = require('fs');
global.stack = function () {
    console.error((new Error()).stack);
};
/** Makes the bundled typescript services global or (if passed in) a custom typescriptServices file */
function makeTsGlobal(typescriptServices) {
    var sandbox = {
        // This is going to gather the ts module exports
        ts: {},
        console: console,
        stack: global.stack,
        require: require,
        module: module,
        process: process
    };
    vm.createContext(sandbox);
    if (typescriptServices) {
        vm.runInContext(fs.readFileSync(typescriptServices).toString(), sandbox);
    }
    else {
        sandbox.ts = require('ntypescript');
    }
    // Finally export ts to the local global namespace
    global.ts = sandbox.ts;
}
exports.makeTsGlobal = makeTsGlobal;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvc3RlZmFuby8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvbGliL3R5cGVzY3JpcHQvbWFrZVR5cGVTY3JpcHRHbG9iYWwudHMiLCJzb3VyY2VzIjpbIi9ob21lL3N0ZWZhbm8vLmF0b20vcGFja2FnZXMvYXRvbS10eXBlc2NyaXB0L2xpYi90eXBlc2NyaXB0L21ha2VUeXBlU2NyaXB0R2xvYmFsLnRzIl0sIm5hbWVzIjpbIm1ha2VUc0dsb2JhbCJdLCJtYXBwaW5ncyI6IkFBQ0EsQUFEQSx3Q0FBd0M7QUFDeEMsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFDMUIsSUFBTyxFQUFFLFdBQVcsSUFBSSxDQUFDLENBQUM7QUFJMUIsTUFBTSxDQUFDLEtBQUssR0FBRztJQUNYLE9BQU8sQ0FBQyxLQUFLLENBQUMsQ0FBTSxJQUFJLEtBQUssRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDNUMsQ0FBQyxDQUFBO0FBR0QsQUFEQSxzR0FBc0c7U0FDdEYsWUFBWSxDQUFDLGtCQUEyQjtJQUNwREEsSUFBSUEsT0FBT0EsR0FBR0E7UUFFVkEsQUFEQUEsZ0RBQWdEQTtRQUNoREEsRUFBRUEsRUFBRUEsRUFBRUE7UUFDTkEsT0FBT0EsRUFBRUEsT0FBT0E7UUFDaEJBLEtBQUtBLEVBQUVBLE1BQU1BLENBQUNBLEtBQUtBO1FBQ25CQSxPQUFPQSxFQUFFQSxPQUFPQTtRQUNoQkEsTUFBTUEsRUFBRUEsTUFBTUE7UUFDZEEsT0FBT0EsRUFBRUEsT0FBT0E7S0FDbkJBLENBQUNBO0lBQ0ZBLEVBQUVBLENBQUNBLGFBQWFBLENBQUNBLE9BQU9BLENBQUNBLENBQUNBO0lBRTFCQSxFQUFFQSxDQUFDQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLENBQUNBO1FBQ3JCQSxFQUFFQSxDQUFDQSxZQUFZQSxDQUFDQSxFQUFFQSxDQUFDQSxZQUFZQSxDQUFDQSxrQkFBa0JBLENBQUNBLENBQUNBLFFBQVFBLEVBQUVBLEVBQUVBLE9BQU9BLENBQUNBLENBQUNBO0lBQzdFQSxDQUFDQTtJQUNEQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUNGQSxPQUFPQSxDQUFDQSxFQUFFQSxHQUFHQSxPQUFPQSxDQUFDQSxhQUFhQSxDQUFDQSxDQUFDQTtJQUN4Q0EsQ0FBQ0E7SUFHREEsQUFEQUEsa0RBQWtEQTtJQUNsREEsTUFBTUEsQ0FBQ0EsRUFBRUEsR0FBR0EsT0FBT0EsQ0FBQ0EsRUFBRUEsQ0FBQ0E7QUFDM0JBLENBQUNBO0FBckJlLG9CQUFZLEdBQVosWUFxQmYsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8gTUFHSUNcbmltcG9ydCB2bSA9IHJlcXVpcmUoJ3ZtJyk7XG5pbXBvcnQgZnMgPSByZXF1aXJlKCdmcycpO1xuaW1wb3J0IG9zID0gcmVxdWlyZSgnb3MnKTtcbmltcG9ydCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5nbG9iYWwuc3RhY2sgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmVycm9yKCg8YW55Pm5ldyBFcnJvcigpKS5zdGFjayk7XG59XG5cbi8qKiBNYWtlcyB0aGUgYnVuZGxlZCB0eXBlc2NyaXB0IHNlcnZpY2VzIGdsb2JhbCBvciAoaWYgcGFzc2VkIGluKSBhIGN1c3RvbSB0eXBlc2NyaXB0U2VydmljZXMgZmlsZSAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1ha2VUc0dsb2JhbCh0eXBlc2NyaXB0U2VydmljZXM/OiBzdHJpbmcpIHtcbiAgICB2YXIgc2FuZGJveCA9IHtcbiAgICAgICAgLy8gVGhpcyBpcyBnb2luZyB0byBnYXRoZXIgdGhlIHRzIG1vZHVsZSBleHBvcnRzXG4gICAgICAgIHRzOiB7fSxcbiAgICAgICAgY29uc29sZTogY29uc29sZSxcbiAgICAgICAgc3RhY2s6IGdsb2JhbC5zdGFjayxcbiAgICAgICAgcmVxdWlyZTogcmVxdWlyZSxcbiAgICAgICAgbW9kdWxlOiBtb2R1bGUsXG4gICAgICAgIHByb2Nlc3M6IHByb2Nlc3NcbiAgICB9O1xuICAgIHZtLmNyZWF0ZUNvbnRleHQoc2FuZGJveCk7XG5cbiAgICBpZiAodHlwZXNjcmlwdFNlcnZpY2VzKSB7XG4gICAgICAgIHZtLnJ1bkluQ29udGV4dChmcy5yZWFkRmlsZVN5bmModHlwZXNjcmlwdFNlcnZpY2VzKS50b1N0cmluZygpLCBzYW5kYm94KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHNhbmRib3gudHMgPSByZXF1aXJlKCdudHlwZXNjcmlwdCcpO1xuICAgIH1cblxuICAgIC8vIEZpbmFsbHkgZXhwb3J0IHRzIHRvIHRoZSBsb2NhbCBnbG9iYWwgbmFtZXNwYWNlXG4gICAgZ2xvYmFsLnRzID0gc2FuZGJveC50cztcbn1cbiJdfQ==
//# sourceURL=/home/stefano/.atom/packages/atom-typescript/lib/typescript/makeTypeScriptGlobal.ts
