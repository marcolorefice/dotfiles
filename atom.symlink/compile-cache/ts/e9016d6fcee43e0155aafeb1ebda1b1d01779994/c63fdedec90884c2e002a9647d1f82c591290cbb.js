//   Copyright 2013-2014 Fran√ßois de Campredon
//
//   Licensed under the Apache License, Version 2.0 (the "License");
//   you may not use this file except in compliance with the License.
//   You may obtain a copy of the License at
//
//       http://www.apache.org/licenses/LICENSE-2.0
//
//   Unless required by applicable law or agreed to in writing, software
//   distributed under the License is distributed on an "AS IS" BASIS,
//   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//   See the License for the specific language governing permissions and
//   limitations under the License.
'use strict';
var path = require('path');
function mapValues(map) {
    return Object.keys(map).reduce(function (result, key) {
        result.push(map[key]);
        return result;
    }, []);
}
exports.mapValues = mapValues;
/**
 * assign all properties of a list of object to an object
 * @param target the object that will receive properties
 * @param items items which properties will be assigned to a target
 */
function assign(target) {
    var items = [];
    for (var _i = 1; _i < arguments.length; _i++) {
        items[_i - 1] = arguments[_i];
    }
    return items.reduce(function (target, source) {
        return Object.keys(source).reduce(function (target, key) {
            target[key] = source[key];
            return target;
        }, target);
    }, target);
}
exports.assign = assign;
/**
 * clone an object (shallow)
 * @param target the object to clone
 */
function clone(target) {
    return assign(Array.isArray(target) ? [] : {}, target);
}
exports.clone = clone;
/**
 * Create a quick lookup map from list
 */
function createMap(arr) {
    return arr.reduce(function (result, key) {
        result[key] = true;
        return result;
    }, {});
}
exports.createMap = createMap;
/**
 * browserify path.resolve is buggy on windows
 */
function pathResolve(from, to) {
    var result = path.resolve(from, to);
    var index = result.indexOf(from[0]);
    return result.slice(index);
}
exports.pathResolve = pathResolve;
var Signal = (function () {
    function Signal() {
        /**
         * list of listeners that have been suscribed to this signal
         */
        this.listeners = [];
        /**
         * Priorities corresponding to the listeners
         */
        this.priorities = [];
    }
    /**
     * Subscribes a listener for the signal.
     *
     * @params listener the callback to call when events are dispatched
     * @params priority an optional priority for this signal
     */
    Signal.prototype.add = function (listener, priority) {
        if (priority === void 0) { priority = 0; }
        var index = this.listeners.indexOf(listener);
        if (index !== -1) {
            this.priorities[index] = priority;
            return;
        }
        for (var i = 0, l = this.priorities.length; i < l; i++) {
            if (this.priorities[i] < priority) {
                this.priorities.splice(i, 0, priority);
                this.listeners.splice(i, 0, listener);
                return;
            }
        }
        this.priorities.push(priority);
        this.listeners.push(listener);
    };
    /**
     * unsubscribe a listener for the signal
     *
     * @params listener the previously subscribed listener
     */
    Signal.prototype.remove = function (listener) {
        var index = this.listeners.indexOf(listener);
        if (index >= 0) {
            this.priorities.splice(index, 1);
            this.listeners.splice(index, 1);
        }
    };
    /**
     * dispatch an event
     *
     * @params parameter the parameter attached to the event dispatching
     */
    Signal.prototype.dispatch = function (parameter) {
        var hasBeenCanceled = this.listeners.every(function (listener) {
            var result = listener(parameter);
            return result !== false;
        });
        return hasBeenCanceled;
    };
    /**
     * Remove all listener from the signal
     */
    Signal.prototype.clear = function () {
        this.listeners = [];
        this.priorities = [];
    };
    /**
     * @return true if the listener has been subsribed to this signal
     */
    Signal.prototype.hasListeners = function () {
        return this.listeners.length > 0;
    };
    return Signal;
})();
exports.Signal = Signal;
function binarySearch(array, value) {
    var low = 0;
    var high = array.length - 1;
    while (low <= high) {
        var middle = low + ((high - low) >> 1);
        var midValue = array[middle];
        if (midValue === value) {
            return middle;
        }
        else if (midValue > value) {
            high = middle - 1;
        }
        else {
            low = middle + 1;
        }
    }
    return ~low;
}
exports.binarySearch = binarySearch;
// Not optimized
function selectMany(arr) {
    var result = [];
    for (var i = 0; i < arr.length; i++) {
        for (var j = 0; j < arr[i].length; j++) {
            result.push(arr[i][j]);
        }
    }
    return result;
}
exports.selectMany = selectMany;
// Not particularly awesome e.g. '/..foo' will pass
function pathIsRelative(str) {
    if (!str.length)
        return false;
    return str[0] == '.' || str.substring(0, 2) == "./" || str.substring(0, 3) == "../";
}
exports.pathIsRelative = pathIsRelative;
/** Key is string. Note: this data structure might have been a bad idea. Sorry. */
var Dict = (function () {
    function Dict() {
        this.table = Object.create(null);
    }
    Dict.prototype.setValue = function (key, item) {
        this.table[key] = item;
    };
    Dict.prototype.getValue = function (key) {
        return this.table[key];
    };
    Dict.prototype.clearValue = function (key) {
        delete this.table[key];
    };
    Dict.prototype.clearAll = function () {
        this.table = Object.create(null);
    };
    Dict.prototype.keys = function () {
        return Object.keys(this.table);
    };
    Dict.prototype.values = function () {
        var array = [];
        for (var key in this.table) {
            array.push(this.table[key]);
        }
        return array;
    };
    return Dict;
})();
exports.Dict = Dict;
/** for testing ui lags only */
function delay(seconds) {
    if (seconds === void 0) { seconds = 2; }
    delayMilliseconds(seconds * 1000);
}
exports.delay = delay;
;
function delayMilliseconds(milliseconds) {
    if (milliseconds === void 0) { milliseconds = 100; }
    // Delay the thread
    var d1 = new Date();
    var d2 = new Date();
    while (d2.valueOf() < d1.valueOf() + milliseconds) {
        d2 = new Date();
    }
}
exports.delayMilliseconds = delayMilliseconds;
;
var now = function () { return new Date().getTime(); };
function debounce(func, milliseconds, immediate) {
    if (immediate === void 0) { immediate = false; }
    var timeout, args, context, timestamp, result;
    var wait = milliseconds;
    var later = function () {
        var last = now() - timestamp;
        if (last < wait && last > 0) {
            timeout = setTimeout(later, wait - last);
        }
        else {
            timeout = null;
            if (!immediate) {
                result = func.apply(context, args);
                if (!timeout)
                    context = args = null;
            }
        }
    };
    return function () {
        context = this;
        args = arguments;
        timestamp = now();
        var callNow = immediate && !timeout;
        if (!timeout)
            timeout = setTimeout(later, wait);
        if (callNow) {
            result = func.apply(context, args);
            context = args = null;
        }
        return result;
    };
}
exports.debounce = debounce;
;
var punctuations = createMap([';', '{', '}', '(', ')', '.', ':', '<', '>', "'", '"']);
exports.prefixEndsInPunctuation = function (prefix) { return prefix.length && prefix.trim().length && punctuations[prefix.trim()[prefix.trim().length - 1]]; };
var nameExtractorRegex = /return (.*);/;
/** Get the name using a lambda so that you don't have magic strings */
function getName(nameLambda) {
    var m = nameExtractorRegex.exec(nameLambda + "");
    if (m == null)
        throw new Error("The function does not contain a statement matching 'return variableName;'");
    var access = m[1].split('.');
    return access[access.length - 1];
}
exports.getName = getName;
/** Sloppy but effective code to find distinct */
function distinct(arr) {
    var map = createMap(arr);
    return Object.keys(map);
}
exports.distinct = distinct;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiL2hvbWUvc3RlZmFuby8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvbGliL21haW4vbGFuZy91dGlscy50cyIsInNvdXJjZXMiOlsiL2hvbWUvc3RlZmFuby8uYXRvbS9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvbGliL21haW4vbGFuZy91dGlscy50cyJdLCJuYW1lcyI6WyJtYXBWYWx1ZXMiLCJhc3NpZ24iLCJjbG9uZSIsImNyZWF0ZU1hcCIsInBhdGhSZXNvbHZlIiwiU2lnbmFsIiwiU2lnbmFsLmNvbnN0cnVjdG9yIiwiU2lnbmFsLmFkZCIsIlNpZ25hbC5yZW1vdmUiLCJTaWduYWwuZGlzcGF0Y2giLCJTaWduYWwuY2xlYXIiLCJTaWduYWwuaGFzTGlzdGVuZXJzIiwiYmluYXJ5U2VhcmNoIiwic2VsZWN0TWFueSIsInBhdGhJc1JlbGF0aXZlIiwiRGljdCIsIkRpY3QuY29uc3RydWN0b3IiLCJEaWN0LnNldFZhbHVlIiwiRGljdC5nZXRWYWx1ZSIsIkRpY3QuY2xlYXJWYWx1ZSIsIkRpY3QuY2xlYXJBbGwiLCJEaWN0LmtleXMiLCJEaWN0LnZhbHVlcyIsImRlbGF5IiwiZGVsYXlNaWxsaXNlY29uZHMiLCJkZWJvdW5jZSIsImdldE5hbWUiLCJkaXN0aW5jdCJdLCJtYXBwaW5ncyI6IkFBQUEsOENBQThDO0FBQzlDLEVBQUU7QUFDRixvRUFBb0U7QUFDcEUscUVBQXFFO0FBQ3JFLDRDQUE0QztBQUM1QyxFQUFFO0FBQ0YsbURBQW1EO0FBQ25ELEVBQUU7QUFDRix3RUFBd0U7QUFDeEUsc0VBQXNFO0FBQ3RFLDZFQUE2RTtBQUM3RSx3RUFBd0U7QUFDeEUsbUNBQW1DO0FBRW5DLFlBQVksQ0FBQztBQUViLElBQU8sSUFBSSxXQUFXLE1BQU0sQ0FBQyxDQUFDO0FBRTlCLFNBQWdCLFNBQVMsQ0FBSSxHQUEyQjtJQUNwREEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFB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Q0FBQztBQUV4QyxBQURBLHVFQUF1RTtTQUN2RCxPQUFPLENBQUMsVUFBcUI7SUFDekNDLElBQUlBLENBQUNBLEdBQUdBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsR0FBR0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDakRBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBO1FBQ1ZBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLDJFQUEyRUEsQ0FBQ0EsQ0FBQ0E7SUFDakdBLElBQUlBLE1BQU1BLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQzdCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxNQUFNQSxHQUFHQSxDQUFDQSxDQUFDQSxDQUFDQTtBQUNyQ0EsQ0FBQ0E7QUFOZSxlQUFPLEdBQVAsT0FNZixDQUFBO0FBR0QsQUFEQSxpREFBaUQ7U0FDakMsUUFBUSxDQUFDLEdBQWE7SUFDbENDLElBQUlBLEdBQUdBLEdBQUdBLFNBQVNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO0lBQ3pCQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtBQUM1QkEsQ0FBQ0E7QUFIZSxnQkFBUSxHQUFSLFFBR2YsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vICAgQ29weXJpZ2h0IDIwMTMtMjAxNCBGcmFuw6dvaXMgZGUgQ2FtcHJlZG9uXG4vL1xuLy8gICBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuLy8gICB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4vLyAgIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuLy9cbi8vICAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuLy9cbi8vICAgVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuLy8gICBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4vLyAgIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuLy8gICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4vLyAgIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuXG5leHBvcnQgZnVuY3Rpb24gbWFwVmFsdWVzPFQ+KG1hcDogeyBbaW5kZXg6IHN0cmluZ106IFQgfSk6IFRbXSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG1hcCkucmVkdWNlKChyZXN1bHQ6IFRbXSwga2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmVzdWx0LnB1c2gobWFwW2tleV0pO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0sIFtdKTtcbn1cblxuLyoqXG4gKiBhc3NpZ24gYWxsIHByb3BlcnRpZXMgb2YgYSBsaXN0IG9mIG9iamVjdCB0byBhbiBvYmplY3RcbiAqIEBwYXJhbSB0YXJnZXQgdGhlIG9iamVjdCB0aGF0IHdpbGwgcmVjZWl2ZSBwcm9wZXJ0aWVzXG4gKiBAcGFyYW0gaXRlbXMgaXRlbXMgd2hpY2ggcHJvcGVydGllcyB3aWxsIGJlIGFzc2lnbmVkIHRvIGEgdGFyZ2V0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBhc3NpZ24odGFyZ2V0OiBhbnksIC4uLml0ZW1zOiBhbnlbXSk6IGFueSB7XG4gICAgcmV0dXJuIGl0ZW1zLnJlZHVjZShmdW5jdGlvbih0YXJnZXQ6IGFueSwgc291cmNlOiBhbnkpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKHNvdXJjZSkucmVkdWNlKCh0YXJnZXQ6IGFueSwga2V5OiBzdHJpbmcpID0+IHtcbiAgICAgICAgICAgIHRhcmdldFtrZXldID0gc291cmNlW2tleV07XG4gICAgICAgICAgICByZXR1cm4gdGFyZ2V0O1xuICAgICAgICB9LCB0YXJnZXQpO1xuICAgIH0sIHRhcmdldCk7XG59XG5cbi8qKlxuICogY2xvbmUgYW4gb2JqZWN0IChzaGFsbG93KVxuICogQHBhcmFtIHRhcmdldCB0aGUgb2JqZWN0IHRvIGNsb25lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbG9uZTxUPih0YXJnZXQ6IFQpOiBUIHtcbiAgICByZXR1cm4gYXNzaWduKEFycmF5LmlzQXJyYXkodGFyZ2V0KSA/IFtdIDoge30sIHRhcmdldCk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgcXVpY2sgbG9va3VwIG1hcCBmcm9tIGxpc3RcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1hcChhcnI6IChzdHJpbmd8bnVtYmVyKVtdKTogeyBbc3RyaW5nOiBzdHJpbmddOiBib29sZWFuO1tudW1iZXI6IG51bWJlcl06IGJvb2xlYW4gfSB7XG4gICAgcmV0dXJuIGFyci5yZWR1Y2UoKHJlc3VsdDogeyBbc3RyaW5nOiBzdHJpbmddOiBib29sZWFuIH0sIGtleTogc3RyaW5nKSA9PiB7XG4gICAgICAgIHJlc3VsdFtrZXldID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9LCA8eyBbc3RyaW5nOiBzdHJpbmddOiBib29sZWFuIH0+e30pO1xufVxuXG5cbi8qKlxuICogYnJvd3NlcmlmeSBwYXRoLnJlc29sdmUgaXMgYnVnZ3kgb24gd2luZG93c1xuICovXG5leHBvcnQgZnVuY3Rpb24gcGF0aFJlc29sdmUoZnJvbTogc3RyaW5nLCB0bzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICB2YXIgcmVzdWx0ID0gcGF0aC5yZXNvbHZlKGZyb20sIHRvKTtcbiAgICB2YXIgaW5kZXggPSByZXN1bHQuaW5kZXhPZihmcm9tWzBdKTtcbiAgICByZXR1cm4gcmVzdWx0LnNsaWNlKGluZGV4KTtcbn1cblxuXG4vKipcbiAqIEMjIGxpa2UgZXZlbnRzIGFuZCBkZWxlZ2F0ZXMgZm9yIHR5cGVkIGV2ZW50c1xuICogZGlzcGF0Y2hpbmdcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBJU2lnbmFsPFQ+IHtcbiAgICAvKipcbiAgICAgKiBTdWJzY3JpYmVzIGEgbGlzdGVuZXIgZm9yIHRoZSBzaWduYWwuXG4gICAgICpcbiAgICAgKiBAcGFyYW1zIGxpc3RlbmVyIHRoZSBjYWxsYmFjayB0byBjYWxsIHdoZW4gZXZlbnRzIGFyZSBkaXNwYXRjaGVkXG4gICAgICogQHBhcmFtcyBwcmlvcml0eSBhbiBvcHRpb25hbCBwcmlvcml0eSBmb3IgdGhpcyBzaWduYWxcbiAgICAgKi9cbiAgICBhZGQobGlzdGVuZXI6IChwYXJhbWV0ZXI6IFQpID0+IGFueSwgcHJpb3JpdHk/OiBudW1iZXIpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogdW5zdWJzY3JpYmUgYSBsaXN0ZW5lciBmb3IgdGhlIHNpZ25hbFxuICAgICAqXG4gICAgICogQHBhcmFtcyBsaXN0ZW5lciB0aGUgcHJldmlvdXNseSBzdWJzY3JpYmVkIGxpc3RlbmVyXG4gICAgICovXG4gICAgcmVtb3ZlKGxpc3RlbmVyOiAocGFyYW1ldGVyOiBUKSA9PiBhbnkpOiB2b2lkO1xuXG4gICAgLyoqXG4gICAgICogZGlzcGF0Y2ggYW4gZXZlbnRcbiAgICAgKlxuICAgICAqIEBwYXJhbXMgcGFyYW1ldGVyIHRoZSBwYXJhbWV0ZXIgYXR0YWNoZWQgdG8gdGhlIGV2ZW50IGRpc3BhdGNoaW5nXG4gICAgICovXG4gICAgZGlzcGF0Y2gocGFyYW1ldGVyPzogVCk6IGJvb2xlYW47XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIGxpc3RlbmVyIGZyb20gdGhlIHNpZ25hbFxuICAgICAqL1xuICAgIGNsZWFyKCk6IHZvaWQ7XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGxpc3RlbmVyIGhhcyBiZWVuIHN1YnNyaWJlZCB0byB0aGlzIHNpZ25hbFxuICAgICAqL1xuICAgIGhhc0xpc3RlbmVycygpOiBib29sZWFuO1xufVxuXG5cbmV4cG9ydCBjbGFzcyBTaWduYWw8VD4gaW1wbGVtZW50cyBJU2lnbmFsPFQ+IHtcblxuICAgIC8qKlxuICAgICAqIGxpc3Qgb2YgbGlzdGVuZXJzIHRoYXQgaGF2ZSBiZWVuIHN1c2NyaWJlZCB0byB0aGlzIHNpZ25hbFxuICAgICAqL1xuICAgIHByaXZhdGUgbGlzdGVuZXJzOiB7IChwYXJhbWV0ZXI6IFQpOiBhbnkgfVtdID0gW107XG5cbiAgICAvKipcbiAgICAgKiBQcmlvcml0aWVzIGNvcnJlc3BvbmRpbmcgdG8gdGhlIGxpc3RlbmVyc1xuICAgICAqL1xuICAgIHByaXZhdGUgcHJpb3JpdGllczogbnVtYmVyW10gPSBbXTtcblxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZXMgYSBsaXN0ZW5lciBmb3IgdGhlIHNpZ25hbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbXMgbGlzdGVuZXIgdGhlIGNhbGxiYWNrIHRvIGNhbGwgd2hlbiBldmVudHMgYXJlIGRpc3BhdGNoZWRcbiAgICAgKiBAcGFyYW1zIHByaW9yaXR5IGFuIG9wdGlvbmFsIHByaW9yaXR5IGZvciB0aGlzIHNpZ25hbFxuICAgICAqL1xuICAgIGFkZChsaXN0ZW5lcjogKHBhcmFtZXRlcjogVCkgPT4gYW55LCBwcmlvcml0eSA9IDApOiB2b2lkIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5saXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgIHRoaXMucHJpb3JpdGllc1tpbmRleF0gPSBwcmlvcml0eTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gMCwgbCA9IHRoaXMucHJpb3JpdGllcy5sZW5ndGg7IGkgPCBsOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByaW9yaXRpZXNbaV0gPCBwcmlvcml0eSkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdGllcy5zcGxpY2UoaSwgMCwgcHJpb3JpdHkpO1xuICAgICAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnNwbGljZShpLCAwLCBsaXN0ZW5lcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucHJpb3JpdGllcy5wdXNoKHByaW9yaXR5KTtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMucHVzaChsaXN0ZW5lcik7XG4gICAgfVxuXG4gICAgLyoqXG4gICAgICogdW5zdWJzY3JpYmUgYSBsaXN0ZW5lciBmb3IgdGhlIHNpZ25hbFxuICAgICAqXG4gICAgICogQHBhcmFtcyBsaXN0ZW5lciB0aGUgcHJldmlvdXNseSBzdWJzY3JpYmVkIGxpc3RlbmVyXG4gICAgICovXG4gICAgcmVtb3ZlKGxpc3RlbmVyOiAocGFyYW1ldGVyOiBUKSA9PiBhbnkpOiB2b2lkIHtcbiAgICAgICAgdmFyIGluZGV4ID0gdGhpcy5saXN0ZW5lcnMuaW5kZXhPZihsaXN0ZW5lcik7XG4gICAgICAgIGlmIChpbmRleCA+PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnByaW9yaXRpZXMuc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIHRoaXMubGlzdGVuZXJzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBkaXNwYXRjaCBhbiBldmVudFxuICAgICAqXG4gICAgICogQHBhcmFtcyBwYXJhbWV0ZXIgdGhlIHBhcmFtZXRlciBhdHRhY2hlZCB0byB0aGUgZXZlbnQgZGlzcGF0Y2hpbmdcbiAgICAgKi9cbiAgICBkaXNwYXRjaChwYXJhbWV0ZXI/OiBUKTogYm9vbGVhbiB7XG4gICAgICAgIHZhciBoYXNCZWVuQ2FuY2VsZWQgPSB0aGlzLmxpc3RlbmVycy5ldmVyeSgobGlzdGVuZXI6IChwYXJhbWV0ZXI6IFQpID0+IGFueSkgPT4ge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGxpc3RlbmVyKHBhcmFtZXRlcik7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0ICE9PSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIGhhc0JlZW5DYW5jZWxlZDtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBSZW1vdmUgYWxsIGxpc3RlbmVyIGZyb20gdGhlIHNpZ25hbFxuICAgICAqL1xuICAgIGNsZWFyKCk6IHZvaWQge1xuICAgICAgICB0aGlzLmxpc3RlbmVycyA9IFtdO1xuICAgICAgICB0aGlzLnByaW9yaXRpZXMgPSBbXTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBAcmV0dXJuIHRydWUgaWYgdGhlIGxpc3RlbmVyIGhhcyBiZWVuIHN1YnNyaWJlZCB0byB0aGlzIHNpZ25hbFxuICAgICAqL1xuICAgIGhhc0xpc3RlbmVycygpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubGlzdGVuZXJzLmxlbmd0aCA+IDA7XG4gICAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gYmluYXJ5U2VhcmNoKGFycmF5OiBudW1iZXJbXSwgdmFsdWU6IG51bWJlcik6IG51bWJlciB7XG4gICAgdmFyIGxvdyA9IDA7XG4gICAgdmFyIGhpZ2ggPSBhcnJheS5sZW5ndGggLSAxO1xuXG4gICAgd2hpbGUgKGxvdyA8PSBoaWdoKSB7XG4gICAgICAgIHZhciBtaWRkbGUgPSBsb3cgKyAoKGhpZ2ggLSBsb3cpID4+IDEpO1xuICAgICAgICB2YXIgbWlkVmFsdWUgPSBhcnJheVttaWRkbGVdO1xuXG4gICAgICAgIGlmIChtaWRWYWx1ZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIHJldHVybiBtaWRkbGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobWlkVmFsdWUgPiB2YWx1ZSkge1xuICAgICAgICAgICAgaGlnaCA9IG1pZGRsZSAtIDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBsb3cgPSBtaWRkbGUgKyAxO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIH5sb3c7XG59XG5cbi8vIE5vdCBvcHRpbWl6ZWRcbmV4cG9ydCBmdW5jdGlvbiBzZWxlY3RNYW55PFQ+KGFycjogVFtdW10pOiBUW10ge1xuICAgIHZhciByZXN1bHQgPSBbXTtcbiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGFycltpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2goYXJyW2ldW2pdKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0O1xufVxuXG4vLyBOb3QgcGFydGljdWxhcmx5IGF3ZXNvbWUgZS5nLiAnLy4uZm9vJyB3aWxsIHBhc3NcbmV4cG9ydCBmdW5jdGlvbiBwYXRoSXNSZWxhdGl2ZShzdHI6IHN0cmluZykge1xuICAgIGlmICghc3RyLmxlbmd0aCkgcmV0dXJuIGZhbHNlO1xuICAgIHJldHVybiBzdHJbMF0gPT0gJy4nIHx8IHN0ci5zdWJzdHJpbmcoMCwgMikgPT0gXCIuL1wiIHx8IHN0ci5zdWJzdHJpbmcoMCwgMykgPT0gXCIuLi9cIjtcbn1cblxuLyoqIEtleSBpcyBzdHJpbmcuIE5vdGU6IHRoaXMgZGF0YSBzdHJ1Y3R1cmUgbWlnaHQgaGF2ZSBiZWVuIGEgYmFkIGlkZWEuIFNvcnJ5LiAqL1xuZXhwb3J0IGNsYXNzIERpY3Q8VD57XG4gICAgcHVibGljIHRhYmxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgICBjb25zdHJ1Y3RvcigpIHsgfVxuICAgIHNldFZhbHVlKGtleTogc3RyaW5nLCBpdGVtOiBUKSB7XG4gICAgICAgIHRoaXMudGFibGVba2V5XSA9IGl0ZW07XG4gICAgfVxuICAgIGdldFZhbHVlKGtleTogc3RyaW5nKSB7IHJldHVybiB0aGlzLnRhYmxlW2tleV07IH1cbiAgICBjbGVhclZhbHVlKGtleTogc3RyaW5nKSB7XG4gICAgICAgIGRlbGV0ZSB0aGlzLnRhYmxlW2tleV07XG4gICAgfVxuICAgIGNsZWFyQWxsKCkgeyB0aGlzLnRhYmxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsgfVxuICAgIGtleXMoKSB7IHJldHVybiBPYmplY3Qua2V5cyh0aGlzLnRhYmxlKTsgfVxuICAgIHZhbHVlcygpOiBUW10ge1xuICAgICAgICB2YXIgYXJyYXkgPSBbXTtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIHRoaXMudGFibGUpIHtcbiAgICAgICAgICAgIGFycmF5LnB1c2godGhpcy50YWJsZVtrZXldKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXJyYXk7XG4gICAgfVxufVxuXG4vKiogZm9yIHRlc3RpbmcgdWkgbGFncyBvbmx5ICovXG5leHBvcnQgZnVuY3Rpb24gZGVsYXkoc2Vjb25kczogbnVtYmVyID0gMikge1xuICAgIGRlbGF5TWlsbGlzZWNvbmRzKHNlY29uZHMgKiAxMDAwKTtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBkZWxheU1pbGxpc2Vjb25kcyhtaWxsaXNlY29uZHM6IG51bWJlciA9IDEwMCkge1xuICAgIC8vIERlbGF5IHRoZSB0aHJlYWRcbiAgICB2YXIgZDEgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciBkMiA9IG5ldyBEYXRlKCk7XG4gICAgd2hpbGUgKGQyLnZhbHVlT2YoKSA8IGQxLnZhbHVlT2YoKSArIG1pbGxpc2Vjb25kcykge1xuICAgICAgICBkMiA9IG5ldyBEYXRlKCk7XG4gICAgfVxufTtcblxudmFyIG5vdyA9ICgpID0+IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuXG5leHBvcnQgZnVuY3Rpb24gZGVib3VuY2U8VCBleHRlbmRzIEZ1bmN0aW9uPihmdW5jOiBULCBtaWxsaXNlY29uZHM6IG51bWJlciwgaW1tZWRpYXRlID0gZmFsc2UpOiBUIHtcbiAgICB2YXIgdGltZW91dCwgYXJncywgY29udGV4dCwgdGltZXN0YW1wLCByZXN1bHQ7XG5cbiAgICB2YXIgd2FpdCA9IG1pbGxpc2Vjb25kcztcblxuICAgIHZhciBsYXRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgbGFzdCA9IG5vdygpIC0gdGltZXN0YW1wO1xuXG4gICAgICAgIGlmIChsYXN0IDwgd2FpdCAmJiBsYXN0ID4gMCkge1xuICAgICAgICAgICAgdGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQgLSBsYXN0KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRpbWVvdXQgPSBudWxsO1xuICAgICAgICAgICAgaWYgKCFpbW1lZGlhdGUpIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgPSBmdW5jLmFwcGx5KGNvbnRleHQsIGFyZ3MpO1xuICAgICAgICAgICAgICAgIGlmICghdGltZW91dCkgY29udGV4dCA9IGFyZ3MgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiA8YW55PmZ1bmN0aW9uKCkge1xuICAgICAgICBjb250ZXh0ID0gdGhpcztcbiAgICAgICAgYXJncyA9IGFyZ3VtZW50cztcbiAgICAgICAgdGltZXN0YW1wID0gbm93KCk7XG4gICAgICAgIHZhciBjYWxsTm93ID0gaW1tZWRpYXRlICYmICF0aW1lb3V0O1xuICAgICAgICBpZiAoIXRpbWVvdXQpIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGxhdGVyLCB3YWl0KTtcbiAgICAgICAgaWYgKGNhbGxOb3cpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGZ1bmMuYXBwbHkoY29udGV4dCwgYXJncyk7XG4gICAgICAgICAgICBjb250ZXh0ID0gYXJncyA9IG51bGw7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH07XG59O1xuXG52YXIgcHVuY3R1YXRpb25zID0gY3JlYXRlTWFwKFsnOycsICd7JywgJ30nLCAnKCcsICcpJywgJy4nLCAnOicsICc8JywgJz4nLCBcIidcIiwgJ1wiJ10pO1xuZXhwb3J0IHZhciBwcmVmaXhFbmRzSW5QdW5jdHVhdGlvbiA9IChwcmVmaXgpID0+IHByZWZpeC5sZW5ndGggJiYgcHJlZml4LnRyaW0oKS5sZW5ndGggJiYgcHVuY3R1YXRpb25zW3ByZWZpeC50cmltKClbcHJlZml4LnRyaW0oKS5sZW5ndGggLSAxXV07XG5cbnZhciBuYW1lRXh0cmFjdG9yUmVnZXggPSAvcmV0dXJuICguKik7Lztcbi8qKiBHZXQgdGhlIG5hbWUgdXNpbmcgYSBsYW1iZGEgc28gdGhhdCB5b3UgZG9uJ3QgaGF2ZSBtYWdpYyBzdHJpbmdzICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmFtZShuYW1lTGFtYmRhOiAoKSA9PiBhbnkpIHtcbiAgICB2YXIgbSA9IG5hbWVFeHRyYWN0b3JSZWdleC5leGVjKG5hbWVMYW1iZGEgKyBcIlwiKTtcbiAgICBpZiAobSA9PSBudWxsKVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUaGUgZnVuY3Rpb24gZG9lcyBub3QgY29udGFpbiBhIHN0YXRlbWVudCBtYXRjaGluZyAncmV0dXJuIHZhcmlhYmxlTmFtZTsnXCIpO1xuICAgIHZhciBhY2Nlc3MgPSBtWzFdLnNwbGl0KCcuJyk7XG4gICAgcmV0dXJuIGFjY2Vzc1thY2Nlc3MubGVuZ3RoIC0gMV07XG59XG5cbi8qKiBTbG9wcHkgYnV0IGVmZmVjdGl2ZSBjb2RlIHRvIGZpbmQgZGlzdGluY3QgKi9cbmV4cG9ydCBmdW5jdGlvbiBkaXN0aW5jdChhcnI6IHN0cmluZ1tdKTogc3RyaW5nW10ge1xuICAgIHZhciBtYXAgPSBjcmVhdGVNYXAoYXJyKTtcbiAgICByZXR1cm4gT2JqZWN0LmtleXMobWFwKTtcbn0iXX0=
//# sourceURL=/home/stefano/.atom/packages/atom-typescript/lib/main/lang/utils.ts
