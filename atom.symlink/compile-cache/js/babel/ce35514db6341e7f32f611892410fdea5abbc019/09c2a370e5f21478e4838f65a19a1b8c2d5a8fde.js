Object.defineProperty(exports, '__esModule', {
	value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _commandsGenerate = require('./commands/generate');

var _commandsGenerate2 = _interopRequireDefault(_commandsGenerate);

var lazyReq = require('lazy-req')(require);

var statusTile = lazyReq('./lib/statustile-view');
var editorconfig = lazyReq('editorconfig');

var STATES = ['subtle', 'success', 'info', 'warning', 'error'];

// Holds all **blacklisted** packages and the properties we assume are affected by them
// 'packagename': [properties]
var BLACKLISTED_PACKAGES = {
	whitespace: ['insert_final_newline', 'trim_trailing_whitespace']
};

// Sets the state of the embedded editorconfig
// This includes the severity (info, warning..) as well as the notification-messages for users
function setState(ecfg) {
	var messages = [];
	var statcon = 0;

	// Check if any editorconfig-setting is in use
	if (Object.keys(ecfg.settings).reduce(function (prev, curr) {
		return ecfg.settings[curr] !== 'auto' || prev;
	}, false)) {
		statcon = Math.max(statcon, 1);
	}

	// Check the 'Tab Type'-setting
	if (ecfg.settings.indent_style !== 'auto' && atom.config.get('editor.tabType') !== 'auto') {
		var tabType = atom.config.get('editor.tabType');

		messages.push('**Tab Type:** You editor\'s configuration setting "Tab Type"\n\t\t(currently "' + tabType + '" prevents the editorconfig-property `indent_style` from working.\n\t\t@"Tab Type" **must** be set to "auto" to fix this issue.');

		statcon = Math.max(statcon, 4);
	}

	// Check for BLACKLISTED packages
	var suspiciuousPackages = {};
	var affectedProperties = undefined;
	for (var packageName in BLACKLISTED_PACKAGES) {
		if (({}).hasOwnProperty.call(BLACKLISTED_PACKAGES, packageName)) {
			affectedProperties = BLACKLISTED_PACKAGES[packageName].filter(function (prop) {
				return ecfg.settings[prop] !== 'auto';
			});
			if (affectedProperties.length > 0 && atom.packages.isPackageActive(packageName)) {
				suspiciuousPackages[packageName] = affectedProperties;
			}
		}
	}
	if (Object.keys(suspiciuousPackages).length > 0) {
		for (var packageName in suspiciuousPackages) {
			if (({}).hasOwnProperty.call(suspiciuousPackages, packageName)) {
				var properties = suspiciuousPackages[packageName];
				messages.push('**' + packageName + ':** It is likely that the\n\t\t\t\t' + packageName + '-package prevents the following\n\t\t\t\tpropert' + (properties.length > 1 ? 'ies' : 'y') + ' from working reliably:\n\t\t\t\t`' + properties.join('`, `') + '`.@You may deactivate or disable the ' + packageName + '-package\n\t\t\t\tto fix that issue.');
			}
		}
		statcon = Math.max(statcon, 3);
	}

	switch (statcon) {
		case 1:
			messages.push('The editorconfig was applied successfully and the editor for this file\n\t\t\tshould work as expected. If you face any unexpected behavior please report us the issue.\n\t\t\t♥️');
			break;
		case 0:
			messages.push('For this file were no editorconfig-settings applied.');
			break;
		default:
			break;
	}

	// Apply changes
	ecfg.messages = messages;
	ecfg.state = STATES[statcon];
	statusTile().update(ecfg.state);
}

// Reapplies the whole editorconfig to **all** open TextEditor-instances
function reapplyEditorconfig() {
	var textEditors = atom.workspace.getTextEditors();
	for (var index in textEditors) {
		// eslint-disable-line guard-for-in
		observeTextEditor(textEditors[index]);
	}
}

// Reapplies the settings immediately after changing the focus to a new pane
function observeActivePaneItem(editor) {
	if (editor && editor.constructor.name === 'TextEditor') {
		if (editor.getBuffer().editorconfig) {
			editor.getBuffer().editorconfig.applySettings();
		}
	} else {
		statusTile().update('subtle');
	}
}

// Initializes the (into the TextBuffer-instance) embedded editorconfig-object
function initializeTextBuffer(buffer) {
	if ('editorconfig' in buffer === false) {
		buffer.editorconfig = {
			buffer: buffer, // preserving a reference to the parent TextBuffer
			state: 'subtle',
			settings: {
				trim_trailing_whitespace: 'auto', // eslint-disable-line camelcase
				insert_final_newline: 'auto', // eslint-disable-line camelcase
				end_of_line: 'auto', // eslint-disable-line camelcase
				indent_style: 'auto', // eslint-disable-line camelcase
				tab_width: 'auto', // eslint-disable-line camelcase
				charset: 'auto' // eslint-disable-line camelcase
			},

			// Applies the settings to the buffer and the corresponding editor
			applySettings: function applySettings() {
				var editor = atom.workspace.getActiveTextEditor();
				var settings = this.settings;

				if (editor && editor.getBuffer() === buffer) {
					if (settings.indent_style !== 'auto') {
						editor.setSoftTabs(settings.indent_style === 'space');
					}
					if (settings.tab_width !== 'auto') {
						editor.setTabLength(settings.tab_width);
					}
					if (settings.end_of_line !== 'auto') {
						buffer.setPreferredLineEnding(settings.end_of_line);
					}
					if (settings.charset !== 'auto') {
						buffer.setEncoding(settings.charset);
					}
				}
				setState(this);
			},

			// onWillSave-Event-Handler
			// Trims whitespaces and inserts/strips final newline before saving
			onWillSave: function onWillSave() {
				var settings = this.settings;

				if (settings.trim_trailing_whitespace === true) {
					// eslint-disable-next-line max-params
					buffer.backwardsScan(/[ \t]+$/m, function (params) {
						if (params.match[0].length > 0) {
							params.replace('');
						}
					});
				}

				if (settings.insert_final_newline !== 'auto') {
					var lastRow = buffer.getLineCount() - 1;

					if (buffer.isRowBlank(lastRow)) {
						var previousNonBlankRow = buffer.previousNonBlankRow(lastRow);

						// Strip empty lines from the end
						if (previousNonBlankRow < lastRow) {
							buffer.deleteRows(previousNonBlankRow + 1, lastRow);
						}
					}
					if (settings.insert_final_newline === true) {
						buffer.append('\n');
					}
				}
			}
		};

		buffer.onWillSave(buffer.editorconfig.onWillSave.bind(buffer.editorconfig));
		if (buffer.getUri() && buffer.getUri().match(/[\\|\/]\.editorconfig$/g) !== null) {
			buffer.onDidSave(reapplyEditorconfig);
		}
	}
}

// Reveal and apply the editorconfig for the given TextEditor-instance
function observeTextEditor(editor) {
	if (!editor) {
		return;
	}
	initializeTextBuffer(editor.getBuffer());

	var file = editor.getURI();
	if (!file) {
		editor.onDidSave(function () {
			observeTextEditor(editor);
		});
		return;
	}

	editorconfig().parse(file).then(function (config) {
		if (Object.keys(config).length === 0) {
			return;
		}

		var ecfg = editor.getBuffer().editorconfig;
		var settings = ecfg.settings;
		var lineEndings = {
			crlf: '\r\n',
			cr: '\r',
			lf: '\n'
		};

		// Preserve evaluated Editorconfig
		ecfg.config = config;

		// Carefully normalize and initialize config-settings
		// eslint-disable-next-line camelcase
		settings.trim_trailing_whitespace = 'trim_trailing_whitespace' in config && typeof config.trim_trailing_whitespace === 'boolean' ? config.trim_trailing_whitespace === true : 'auto';

		// eslint-disable-next-line camelcase
		settings.insert_final_newline = 'insert_final_newline' in config && typeof config.insert_final_newline === 'boolean' ? config.insert_final_newline === true : 'auto';

		// eslint-disable-next-line camelcase
		settings.indent_style = 'indent_style' in config && config.indent_style.search(/^(space|tab)$/) > -1 ? config.indent_style : 'auto';

		// eslint-disable-next-line camelcase
		settings.end_of_line = lineEndings[config.end_of_line] || 'auto';

		// eslint-disable-next-line camelcase
		settings.tab_width = parseInt(config.indent_size || config.tab_width, 10);
		if (isNaN(settings.tab_width)) {
			settings.tab_width = 'auto'; // eslint-disable-line camelcase
		}

		settings.charset = 'charset' in config ? config.charset.replace(/-/g, '').toLowerCase() : 'auto';

		// Apply initially
		ecfg.applySettings();
	})['catch'](Error, function (e) {
		console.warn('atom-editorconfig: ' + e);
	});
}

// Hook into the events to recognize the user opening new editors or changing the pane
var activate = function activate() {
	(0, _commandsGenerate2['default'])();
	atom.workspace.observeTextEditors(observeTextEditor);
	atom.workspace.observeActivePaneItem(observeActivePaneItem);
};

// Apply the statusbar icon
var consumeStatusBar = function consumeStatusBar(statusBar) {
	statusBar.addRightTile({
		item: statusTile().create(),
		priority: 999
	});
};

exports['default'] = { activate: activate, consumeStatusBar: consumeStatusBar };
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3N0ZWZhbm8vLmRvdGZpbGVzL2F0b20uc3ltbGluay9wYWNrYWdlcy9lZGl0b3Jjb25maWcvaW5kZXguanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Z0NBQzJCLHFCQUFxQjs7OztBQUVoRCxJQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUM7O0FBRTdDLElBQU0sVUFBVSxHQUFHLE9BQU8sQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0FBQ3BELElBQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUMsQ0FBQzs7QUFFN0MsSUFBTSxNQUFNLEdBQUcsQ0FBQyxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxDQUFDLENBQUM7Ozs7QUFJakUsSUFBTSxvQkFBb0IsR0FBRztBQUM1QixXQUFVLEVBQUUsQ0FBQyxzQkFBc0IsRUFBRSwwQkFBMEIsQ0FBQztDQUNoRSxDQUFDOzs7O0FBSUYsU0FBUyxRQUFRLENBQUMsSUFBSSxFQUFFO0FBQ3ZCLEtBQU0sUUFBUSxHQUFHLEVBQUUsQ0FBQztBQUNwQixLQUFJLE9BQU8sR0FBRyxDQUFDLENBQUM7OztBQUdoQixLQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxVQUFDLElBQUksRUFBRSxJQUFJLEVBQUs7QUFDckQsU0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLE1BQU0sSUFBSSxJQUFJLENBQUM7RUFDOUMsRUFBRSxLQUFLLENBQUMsRUFBRTtBQUNWLFNBQU8sR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztFQUMvQjs7O0FBR0QsS0FBSSxJQUFJLENBQUMsUUFBUSxDQUFDLFlBQVksS0FBSyxNQUFNLElBQ3hDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGdCQUFnQixD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SUFBTSxRQUFRLEdBQUcsU0FBWCxRQUFRLEdBQVM7QUFDdEIscUNBQWdCLENBQUM7QUFDakIsS0FBSSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDO0FBQ3JELEtBQUksQ0FBQyxTQUFTLENBQUMscUJBQXFCLENBQUMscUJBQXFCLENBQUMsQ0FBQztDQUM1RCxDQUFDOzs7QUFHRixJQUFNLGdCQUFnQixHQUFHLFNBQW5CLGdCQUFnQixDQUFHLFNBQVMsRUFBSTtBQUNyQyxVQUFTLENBQUMsWUFBWSxDQUFDO0FBQ3RCLE1BQUksRUFBRSxVQUFVLEVBQUUsQ0FBQyxNQUFNLEVBQUU7QUFDM0IsVUFBUSxFQUFFLEdBQUc7RUFDYixDQUFDLENBQUM7Q0FDSCxDQUFDOztxQkFFYSxFQUFDLFFBQVEsRUFBUixRQUFRLEVBQUUsZ0JBQWdCLEVBQWhCLGdCQUFnQixFQUFDIiwiZmlsZSI6Ii9ob21lL3N0ZWZhbm8vLmRvdGZpbGVzL2F0b20uc3ltbGluay9wYWNrYWdlcy9lZGl0b3Jjb25maWcvaW5kZXguanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQGJhYmVsICovXG5pbXBvcnQgZ2VuZXJhdGVDb25maWcgZnJvbSAnLi9jb21tYW5kcy9nZW5lcmF0ZSc7XG5cbmNvbnN0IGxhenlSZXEgPSByZXF1aXJlKCdsYXp5LXJlcScpKHJlcXVpcmUpO1xuXG5jb25zdCBzdGF0dXNUaWxlID0gbGF6eVJlcSgnLi9saWIvc3RhdHVzdGlsZS12aWV3Jyk7XG5jb25zdCBlZGl0b3Jjb25maWcgPSBsYXp5UmVxKCdlZGl0b3Jjb25maWcnKTtcblxuY29uc3QgU1RBVEVTID0gWydzdWJ0bGUnLCAnc3VjY2VzcycsICdpbmZvJywgJ3dhcm5pbmcnLCAnZXJyb3InXTtcblxuLy8gSG9sZHMgYWxsICoqYmxhY2tsaXN0ZWQqKiBwYWNrYWdlcyBhbmQgdGhlIHByb3BlcnRpZXMgd2UgYXNzdW1lIGFyZSBhZmZlY3RlZCBieSB0aGVtXG4vLyAncGFja2FnZW5hbWUnOiBbcHJvcGVydGllc11cbmNvbnN0IEJMQUNLTElTVEVEX1BBQ0tBR0VTID0ge1xuXHR3aGl0ZXNwYWNlOiBbJ2luc2VydF9maW5hbF9uZXdsaW5lJywgJ3RyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZSddXG59O1xuXG4vLyBTZXRzIHRoZSBzdGF0ZSBvZiB0aGUgZW1iZWRkZWQgZWRpdG9yY29uZmlnXG4vLyBUaGlzIGluY2x1ZGVzIHRoZSBzZXZlcml0eSAoaW5mbywgd2FybmluZy4uKSBhcyB3ZWxsIGFzIHRoZSBub3RpZmljYXRpb24tbWVzc2FnZXMgZm9yIHVzZXJzXG5mdW5jdGlvbiBzZXRTdGF0ZShlY2ZnKSB7XG5cdGNvbnN0IG1lc3NhZ2VzID0gW107XG5cdGxldCBzdGF0Y29uID0gMDtcblxuXHQvLyBDaGVjayBpZiBhbnkgZWRpdG9yY29uZmlnLXNldHRpbmcgaXMgaW4gdXNlXG5cdGlmIChPYmplY3Qua2V5cyhlY2ZnLnNldHRpbmdzKS5yZWR1Y2UoKHByZXYsIGN1cnIpID0+IHtcblx0XHRyZXR1cm4gZWNmZy5zZXR0aW5nc1tjdXJyXSAhPT0gJ2F1dG8nIHx8IHByZXY7XG5cdH0sIGZhbHNlKSkge1xuXHRcdHN0YXRjb24gPSBNYXRoLm1heChzdGF0Y29uLCAxKTtcblx0fVxuXG5cdC8vIENoZWNrIHRoZSAnVGFiIFR5cGUnLXNldHRpbmdcblx0aWYgKGVjZmcuc2V0dGluZ3MuaW5kZW50X3N0eWxlICE9PSAnYXV0bycgJiZcblx0XHRhdG9tLmNvbmZpZy5nZXQoJ2VkaXRvci50YWJUeXBlJykgIT09ICdhdXRvJykge1xuXHRcdGNvbnN0IHRhYlR5cGUgPSBhdG9tLmNvbmZpZy5nZXQoJ2VkaXRvci50YWJUeXBlJyk7XG5cblx0XHRtZXNzYWdlcy5wdXNoKGAqKlRhYiBUeXBlOioqIFlvdSBlZGl0b3IncyBjb25maWd1cmF0aW9uIHNldHRpbmcgXCJUYWIgVHlwZVwiXG5cdFx0KGN1cnJlbnRseSBcIiR7dGFiVHlwZX1cIiBwcmV2ZW50cyB0aGUgZWRpdG9yY29uZmlnLXByb3BlcnR5IFxcYGluZGVudF9zdHlsZVxcYCBmcm9tIHdvcmtpbmcuXG5cdFx0QFwiVGFiIFR5cGVcIiAqKm11c3QqKiBiZSBzZXQgdG8gXCJhdXRvXCIgdG8gZml4IHRoaXMgaXNzdWUuYCk7XG5cblx0XHRzdGF0Y29uID0gTWF0aC5tYXgoc3RhdGNvbiwgNCk7XG5cdH1cblxuXHQvLyBDaGVjayBmb3IgQkxBQ0tMSVNURUQgcGFja2FnZXNcblx0Y29uc3Qgc3VzcGljaXVvdXNQYWNrYWdlcyA9IHt9O1xuXHRsZXQgYWZmZWN0ZWRQcm9wZXJ0aWVzO1xuXHRmb3IgKGNvbnN0IHBhY2thZ2VOYW1lIGluIEJMQUNLTElTVEVEX1BBQ0tBR0VTKSB7XG5cdFx0aWYgKHt9Lmhhc093blByb3BlcnR5LmNhbGwoQkxBQ0tMSVNURURfUEFDS0FHRVMsIHBhY2thZ2VOYW1lKSkge1xuXHRcdFx0YWZmZWN0ZWRQcm9wZXJ0aWVzID0gQkxBQ0tMSVNURURfUEFDS0FHRVNbcGFja2FnZU5hbWVdLmZpbHRlcihwcm9wID0+IHtcblx0XHRcdFx0cmV0dXJuIGVjZmcuc2V0dGluZ3NbcHJvcF0gIT09ICdhdXRvJztcblx0XHRcdH0pO1xuXHRcdFx0aWYgKGFmZmVjdGVkUHJvcGVydGllcy5sZW5ndGggPiAwICYmXG5cdFx0XHRcdGF0b20ucGFja2FnZXMuaXNQYWNrYWdlQWN0aXZlKHBhY2thZ2VOYW1lKSkge1xuXHRcdFx0XHRzdXNwaWNpdW91c1BhY2thZ2VzW3BhY2thZ2VOYW1lXSA9IGFmZmVjdGVkUHJvcGVydGllcztcblx0XHRcdH1cblx0XHR9XG5cdH1cblx0aWYgKE9iamVjdC5rZXlzKHN1c3BpY2l1b3VzUGFja2FnZXMpLmxlbmd0aCA+IDApIHtcblx0XHRmb3IgKGNvbnN0IHBhY2thZ2VOYW1lIGluIHN1c3BpY2l1b3VzUGFja2FnZXMpIHtcblx0XHRcdGlmICh7fS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHN1c3BpY2l1b3VzUGFja2FnZXMsIHBhY2thZ2VOYW1lKSkge1xuXHRcdFx0XHRjb25zdCBwcm9wZXJ0aWVzID0gc3VzcGljaXVvdXNQYWNrYWdlc1twYWNrYWdlTmFtZV07XG5cdFx0XHRcdG1lc3NhZ2VzLnB1c2goYCoqJHtwYWNrYWdlTmFtZX06KiogSXQgaXMgbGlrZWx5IHRoYXQgdGhlXG5cdFx0XHRcdCR7cGFja2FnZU5hbWV9LXBhY2thZ2UgcHJldmVudHMgdGhlIGZvbGxvd2luZ1xuXHRcdFx0XHRwcm9wZXJ0JHtwcm9wZXJ0aWVzLmxlbmd0aCA+IDEgPyAnaWVzJyA6ICd5J30gZnJvbSB3b3JraW5nIHJlbGlhYmx5OlxuXHRcdFx0XHRcXGAke3Byb3BlcnRpZXMuam9pbignYCwgYCcpfVxcYC5AWW91IG1heSBkZWFjdGl2YXRlIG9yIGRpc2FibGUgdGhlICR7cGFja2FnZU5hbWV9LXBhY2thZ2Vcblx0XHRcdFx0dG8gZml4IHRoYXQgaXNzdWUuYCk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHN0YXRjb24gPSBNYXRoLm1heChzdGF0Y29uLCAzKTtcblx0fVxuXG5cdHN3aXRjaCAoc3RhdGNvbikge1xuXHRcdGNhc2UgMTpcblx0XHRcdG1lc3NhZ2VzLnB1c2goYFRoZSBlZGl0b3Jjb25maWcgd2FzIGFwcGxpZWQgc3VjY2Vzc2Z1bGx5IGFuZCB0aGUgZWRpdG9yIGZvciB0aGlzIGZpbGVcblx0XHRcdHNob3VsZCB3b3JrIGFzIGV4cGVjdGVkLiBJZiB5b3UgZmFjZSBhbnkgdW5leHBlY3RlZCBiZWhhdmlvciBwbGVhc2UgcmVwb3J0IHVzIHRoZSBpc3N1ZS5cblx0XHRcdOKZpe+4j2ApO1xuXHRcdFx0YnJlYWs7XG5cdFx0Y2FzZSAwOlxuXHRcdFx0bWVzc2FnZXMucHVzaChgRm9yIHRoaXMgZmlsZSB3ZXJlIG5vIGVkaXRvcmNvbmZpZy1zZXR0aW5ncyBhcHBsaWVkLmApO1xuXHRcdFx0YnJlYWs7XG5cdFx0ZGVmYXVsdDpcblx0XHRcdGJyZWFrO1xuXHR9XG5cblx0Ly8gQXBwbHkgY2hhbmdlc1xuXHRlY2ZnLm1lc3NhZ2VzID0gbWVzc2FnZXM7XG5cdGVjZmcuc3RhdGUgPSBTVEFURVNbc3RhdGNvbl07XG5cdHN0YXR1c1RpbGUoKS51cGRhdGUoZWNmZy5zdGF0ZSk7XG59XG5cbi8vIFJlYXBwbGllcyB0aGUgd2hvbGUgZWRpdG9yY29uZmlnIHRvICoqYWxsKiogb3BlbiBUZXh0RWRpdG9yLWluc3RhbmNlc1xuZnVuY3Rpb24gcmVhcHBseUVkaXRvcmNvbmZpZygpIHtcblx0Y29uc3QgdGV4dEVkaXRvcnMgPSBhdG9tLndvcmtzcGFjZS5nZXRUZXh0RWRpdG9ycygpO1xuXHRmb3IgKGNvbnN0IGluZGV4IGluIHRleHRFZGl0b3JzKSB7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUgZ3VhcmQtZm9yLWluXG5cdFx0b2JzZXJ2ZVRleHRFZGl0b3IodGV4dEVkaXRvcnNbaW5kZXhdKTtcblx0fVxufVxuXG4vLyBSZWFwcGxpZXMgdGhlIHNldHRpbmdzIGltbWVkaWF0ZWx5IGFmdGVyIGNoYW5naW5nIHRoZSBmb2N1cyB0byBhIG5ldyBwYW5lXG5mdW5jdGlvbiBvYnNlcnZlQWN0aXZlUGFuZUl0ZW0oZWRpdG9yKSB7XG5cdGlmIChlZGl0b3IgJiYgZWRpdG9yLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdUZXh0RWRpdG9yJykge1xuXHRcdGlmIChlZGl0b3IuZ2V0QnVmZmVyKCkuZWRpdG9yY29uZmlnKSB7XG5cdFx0XHRlZGl0b3IuZ2V0QnVmZmVyKCkuZWRpdG9yY29uZmlnLmFwcGx5U2V0dGluZ3MoKTtcblx0XHR9XG5cdH0gZWxzZSB7XG5cdFx0c3RhdHVzVGlsZSgpLnVwZGF0ZSgnc3VidGxlJyk7XG5cdH1cbn1cblxuLy8gSW5pdGlhbGl6ZXMgdGhlIChpbnRvIHRoZSBUZXh0QnVmZmVyLWluc3RhbmNlKSBlbWJlZGRlZCBlZGl0b3Jjb25maWctb2JqZWN0XG5mdW5jdGlvbiBpbml0aWFsaXplVGV4dEJ1ZmZlcihidWZmZXIpIHtcblx0aWYgKCdlZGl0b3Jjb25maWcnIGluIGJ1ZmZlciA9PT0gZmFsc2UpIHtcblx0XHRidWZmZXIuZWRpdG9yY29uZmlnID0ge1xuXHRcdFx0YnVmZmVyLCAvLyBwcmVzZXJ2aW5nIGEgcmVmZXJlbmNlIHRvIHRoZSBwYXJlbnQgVGV4dEJ1ZmZlclxuXHRcdFx0c3RhdGU6ICdzdWJ0bGUnLFxuXHRcdFx0c2V0dGluZ3M6IHtcblx0XHRcdFx0dHJpbV90cmFpbGluZ193aGl0ZXNwYWNlOiAnYXV0bycsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0XHRcdGluc2VydF9maW5hbF9uZXdsaW5lOiAnYXV0bycsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0XHRcdGVuZF9vZl9saW5lOiAnYXV0bycsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0XHRcdGluZGVudF9zdHlsZTogJ2F1dG8nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuXHRcdFx0XHR0YWJfd2lkdGg6ICdhdXRvJywgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRcdFx0Y2hhcnNldDogJ2F1dG8nIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0XHR9LFxuXG5cdFx0XHQvLyBBcHBsaWVzIHRoZSBzZXR0aW5ncyB0byB0aGUgYnVmZmVyIGFuZCB0aGUgY29ycmVzcG9uZGluZyBlZGl0b3Jcblx0XHRcdGFwcGx5U2V0dGluZ3MoKSB7XG5cdFx0XHRcdGNvbnN0IGVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKTtcblx0XHRcdFx0Y29uc3Qgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzO1xuXG5cdFx0XHRcdGlmIChlZGl0b3IgJiYgZWRpdG9yLmdldEJ1ZmZlcigpID09PSBidWZmZXIpIHtcblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuaW5kZW50X3N0eWxlICE9PSAnYXV0bycpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZXRTb2Z0VGFicyhzZXR0aW5ncy5pbmRlbnRfc3R5bGUgPT09ICdzcGFjZScpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MudGFiX3dpZHRoICE9PSAnYXV0bycpIHtcblx0XHRcdFx0XHRcdGVkaXRvci5zZXRUYWJMZW5ndGgoc2V0dGluZ3MudGFiX3dpZHRoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmVuZF9vZl9saW5lICE9PSAnYXV0bycpIHtcblx0XHRcdFx0XHRcdGJ1ZmZlci5zZXRQcmVmZXJyZWRMaW5lRW5kaW5nKHNldHRpbmdzLmVuZF9vZl9saW5lKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYgKHNldHRpbmdzLmNoYXJzZXQgIT09ICdhdXRvJykge1xuXHRcdFx0XHRcdFx0YnVmZmVyLnNldEVuY29kaW5nKHNldHRpbmdzLmNoYXJzZXQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRzZXRTdGF0ZSh0aGlzKTtcblx0XHRcdH0sXG5cblx0XHRcdC8vIG9uV2lsbFNhdmUtRXZlbnQtSGFuZGxlclxuXHRcdFx0Ly8gVHJpbXMgd2hpdGVzcGFjZXMgYW5kIGluc2VydHMvc3RyaXBzIGZpbmFsIG5ld2xpbmUgYmVmb3JlIHNhdmluZ1xuXHRcdFx0b25XaWxsU2F2ZSgpIHtcblx0XHRcdFx0Y29uc3Qgc2V0dGluZ3MgPSB0aGlzLnNldHRpbmdzO1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy50cmltX3RyYWlsaW5nX3doaXRlc3BhY2UgPT09IHRydWUpIHtcblx0XHRcdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtc1xuXHRcdFx0XHRcdGJ1ZmZlci5iYWNrd2FyZHNTY2FuKC9bIFxcdF0rJC9tLCBwYXJhbXMgPT4ge1xuXHRcdFx0XHRcdFx0aWYgKHBhcmFtcy5tYXRjaFswXS5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdFx0XHRcdHBhcmFtcy5yZXBsYWNlKCcnKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy5pbnNlcnRfZmluYWxfbmV3bGluZSAhPT0gJ2F1dG8nKSB7XG5cdFx0XHRcdFx0Y29uc3QgbGFzdFJvdyA9IGJ1ZmZlci5nZXRMaW5lQ291bnQoKSAtIDE7XG5cblx0XHRcdFx0XHRpZiAoYnVmZmVyLmlzUm93QmxhbmsobGFzdFJvdykpIHtcblx0XHRcdFx0XHRcdGNvbnN0IHByZXZpb3VzTm9uQmxhbmtSb3cgPSBidWZmZXIucHJldmlvdXNOb25CbGFua1JvdyhsYXN0Um93KTtcblxuXHRcdFx0XHRcdFx0Ly8gU3RyaXAgZW1wdHkgbGluZXMgZnJvbSB0aGUgZW5kXG5cdFx0XHRcdFx0XHRpZiAocHJldmlvdXNOb25CbGFua1JvdyA8IGxhc3RSb3cpIHtcblx0XHRcdFx0XHRcdFx0YnVmZmVyLmRlbGV0ZVJvd3MocHJldmlvdXNOb25CbGFua1JvdyArIDEsIGxhc3RSb3cpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuaW5zZXJ0X2ZpbmFsX25ld2xpbmUgPT09IHRydWUpIHtcblx0XHRcdFx0XHRcdGJ1ZmZlci5hcHBlbmQoJ1xcbicpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHRidWZmZXIub25XaWxsU2F2ZShidWZmZXIuZWRpdG9yY29uZmlnLm9uV2lsbFNhdmUuYmluZChidWZmZXIuZWRpdG9yY29uZmlnKSk7XG5cdFx0aWYgKGJ1ZmZlci5nZXRVcmkoKSAmJiBidWZmZXIuZ2V0VXJpKCkubWF0Y2goL1tcXFxcfFxcL11cXC5lZGl0b3Jjb25maWckL2cpICE9PSBudWxsKSB7XG5cdFx0XHRidWZmZXIub25EaWRTYXZlKHJlYXBwbHlFZGl0b3Jjb25maWcpO1xuXHRcdH1cblx0fVxufVxuXG4vLyBSZXZlYWwgYW5kIGFwcGx5IHRoZSBlZGl0b3Jjb25maWcgZm9yIHRoZSBnaXZlbiBUZXh0RWRpdG9yLWluc3RhbmNlXG5mdW5jdGlvbiBvYnNlcnZlVGV4dEVkaXRvcihlZGl0b3IpIHtcblx0aWYgKCFlZGl0b3IpIHtcblx0XHRyZXR1cm47XG5cdH1cblx0aW5pdGlhbGl6ZVRleHRCdWZmZXIoZWRpdG9yLmdldEJ1ZmZlcigpKTtcblxuXHRjb25zdCBmaWxlID0gZWRpdG9yLmdldFVSSSgpO1xuXHRpZiAoIWZpbGUpIHtcblx0XHRlZGl0b3Iub25EaWRTYXZlKCgpID0+IHtcblx0XHRcdG9ic2VydmVUZXh0RWRpdG9yKGVkaXRvcik7XG5cdFx0fSk7XG5cdFx0cmV0dXJuO1xuXHR9XG5cblx0ZWRpdG9yY29uZmlnKCkucGFyc2UoZmlsZSkudGhlbihjb25maWcgPT4ge1xuXHRcdGlmIChPYmplY3Qua2V5cyhjb25maWcpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGNvbnN0IGVjZmcgPSBlZGl0b3IuZ2V0QnVmZmVyKCkuZWRpdG9yY29uZmlnO1xuXHRcdGNvbnN0IHNldHRpbmdzID0gZWNmZy5zZXR0aW5ncztcblx0XHRjb25zdCBsaW5lRW5kaW5ncyA9IHtcblx0XHRcdGNybGY6ICdcXHJcXG4nLFxuXHRcdFx0Y3I6ICdcXHInLFxuXHRcdFx0bGY6ICdcXG4nXG5cdFx0fTtcblxuXHRcdC8vIFByZXNlcnZlIGV2YWx1YXRlZCBFZGl0b3Jjb25maWdcblx0XHRlY2ZnLmNvbmZpZyA9IGNvbmZpZztcblxuXHRcdC8vIENhcmVmdWxseSBub3JtYWxpemUgYW5kIGluaXRpYWxpemUgY29uZmlnLXNldHRpbmdzXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuXHRcdHNldHRpbmdzLnRyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZSA9ICgndHJpbV90cmFpbGluZ193aGl0ZXNwYWNlJyBpbiBjb25maWcpICYmXG5cdFx0XHR0eXBlb2YgY29uZmlnLnRyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZSA9PT0gJ2Jvb2xlYW4nID9cblx0XHRcdGNvbmZpZy50cmltX3RyYWlsaW5nX3doaXRlc3BhY2UgPT09IHRydWUgOlxuXHRcdFx0J2F1dG8nO1xuXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuXHRcdHNldHRpbmdzLmluc2VydF9maW5hbF9uZXdsaW5lID0gKCdpbnNlcnRfZmluYWxfbmV3bGluZScgaW4gY29uZmlnKSAmJlxuXHRcdFx0dHlwZW9mIGNvbmZpZy5pbnNlcnRfZmluYWxfbmV3bGluZSA9PT0gJ2Jvb2xlYW4nID9cblx0XHRcdGNvbmZpZy5pbnNlcnRfZmluYWxfbmV3bGluZSA9PT0gdHJ1ZSA6XG5cdFx0XHQnYXV0byc7XG5cblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG5cdFx0c2V0dGluZ3MuaW5kZW50X3N0eWxlID0gKCgnaW5kZW50X3N0eWxlJyBpbiBjb25maWcpICYmXG5cdFx0XHRjb25maWcuaW5kZW50X3N0eWxlLnNlYXJjaCgvXihzcGFjZXx0YWIpJC8pID4gLTEpID9cblx0XHRcdGNvbmZpZy5pbmRlbnRfc3R5bGUgOlxuXHRcdFx0J2F1dG8nO1xuXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuXHRcdHNldHRpbmdzLmVuZF9vZl9saW5lID0gbGluZUVuZGluZ3NbY29uZmlnLmVuZF9vZl9saW5lXSB8fCAnYXV0byc7XG5cblx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG5cdFx0c2V0dGluZ3MudGFiX3dpZHRoID0gcGFyc2VJbnQoY29uZmlnLmluZGVudF9zaXplIHx8IGNvbmZpZy50YWJfd2lkdGgsIDEwKTtcblx0XHRpZiAoaXNOYU4oc2V0dGluZ3MudGFiX3dpZHRoKSkge1xuXHRcdFx0c2V0dGluZ3MudGFiX3dpZHRoID0gJ2F1dG8nOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuXHRcdH1cblxuXHRcdHNldHRpbmdzLmNoYXJzZXQgPSAoJ2NoYXJzZXQnIGluIGNvbmZpZykgP1xuXHRcdFx0Y29uZmlnLmNoYXJzZXQucmVwbGFjZSgvLS9nLCAnJykudG9Mb3dlckNhc2UoKSA6XG5cdFx0XHQnYXV0byc7XG5cblx0XHQvLyBBcHBseSBpbml0aWFsbHlcblx0XHRlY2ZnLmFwcGx5U2V0dGluZ3MoKTtcblx0fSkuY2F0Y2goRXJyb3IsIGUgPT4ge1xuXHRcdGNvbnNvbGUud2FybihgYXRvbS1lZGl0b3Jjb25maWc6ICR7ZX1gKTtcblx0fSk7XG59XG5cbi8vIEhvb2sgaW50byB0aGUgZXZlbnRzIHRvIHJlY29nbml6ZSB0aGUgdXNlciBvcGVuaW5nIG5ldyBlZGl0b3JzIG9yIGNoYW5naW5nIHRoZSBwYW5lXG5jb25zdCBhY3RpdmF0ZSA9ICgpID0+IHtcblx0Z2VuZXJhdGVDb25maWcoKTtcblx0YXRvbS53b3Jrc3BhY2Uub2JzZXJ2ZVRleHRFZGl0b3JzKG9ic2VydmVUZXh0RWRpdG9yKTtcblx0YXRvbS53b3Jrc3BhY2Uub2JzZXJ2ZUFjdGl2ZVBhbmVJdGVtKG9ic2VydmVBY3RpdmVQYW5lSXRlbSk7XG59O1xuXG4vLyBBcHBseSB0aGUgc3RhdHVzYmFyIGljb25cbmNvbnN0IGNvbnN1bWVTdGF0dXNCYXIgPSBzdGF0dXNCYXIgPT4ge1xuXHRzdGF0dXNCYXIuYWRkUmlnaHRUaWxlKHtcblx0XHRpdGVtOiBzdGF0dXNUaWxlKCkuY3JlYXRlKCksXG5cdFx0cHJpb3JpdHk6IDk5OVxuXHR9KTtcbn07XG5cbmV4cG9ydCBkZWZhdWx0IHthY3RpdmF0ZSwgY29uc3VtZVN0YXR1c0Jhcn07XG4iXX0=
//# sourceURL=/home/stefano/.dotfiles/atom.symlink/packages/editorconfig/index.js
