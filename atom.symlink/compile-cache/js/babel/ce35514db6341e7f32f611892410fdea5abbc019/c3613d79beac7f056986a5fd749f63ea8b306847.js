Object.defineProperty(exports, '__esModule', {
	value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _commandsGenerate = require('./commands/generate');

var _commandsGenerate2 = _interopRequireDefault(_commandsGenerate);

var lazyReq = require('lazy-req')(require);

var statusTile = lazyReq('./lib/statustile-view');
var editorconfig = lazyReq('editorconfig');

var STATES = ['subtle', 'success', 'info', 'warning', 'error'];

// Holds all **blacklisted** packages and the properties we assume are affected by them
// 'packagename': [properties]
var BLACKLISTED_PACKAGES = {
	whitespace: ['insert_final_newline', 'trim_trailing_whitespace']
};

// Sets the state of the embedded editorconfig
// This includes the severity (info, warning..) as well as the notification-messages for users
function setState(ecfg) {
	var messages = [];
	var statcon = 0;

	// Check if any editorconfig-setting is in use
	if (Object.keys(ecfg.settings).reduce(function (prev, curr) {
		return ecfg.settings[curr] !== 'auto' || prev;
	}, false)) {
		statcon = Math.max(statcon, 1);
	}

	// Check the 'Tab Type'-setting
	if (ecfg.settings.indent_style !== 'auto' && atom.config.get('editor.tabType') !== 'auto') {
		var tabType = atom.config.get('editor.tabType');

		messages.push('**Tab Type:** You editor\'s configuration setting "Tab Type"\n\t\t(currently "' + tabType + '" prevents the editorconfig-property `indent_style` from working.\n\t\t@"Tab Type" **must** be set to "auto" to fix this issue.');

		statcon = Math.max(statcon, 4);
	}

	// Check for BLACKLISTED packages
	var suspiciuousPackages = {};
	var affectedProperties = undefined;
	for (var packageName in BLACKLISTED_PACKAGES) {
		if (({}).hasOwnProperty.call(BLACKLISTED_PACKAGES, packageName)) {
			affectedProperties = BLACKLISTED_PACKAGES[packageName].filter(function (prop) {
				return ecfg.settings[prop] !== 'auto';
			});
			if (affectedProperties.length > 0 && atom.packages.isPackageActive(packageName)) {
				suspiciuousPackages[packageName] = affectedProperties;
			}
		}
	}
	if (Object.keys(suspiciuousPackages).length > 0) {
		for (var packageName in suspiciuousPackages) {
			if (({}).hasOwnProperty.call(suspiciuousPackages, packageName)) {
				var properties = suspiciuousPackages[packageName];
				messages.push('**' + packageName + ':** It is likely that the\n\t\t\t\t' + packageName + '-package prevents the following\n\t\t\t\tpropert' + (properties.length > 1 ? 'ies' : 'y') + ' from working reliably:\n\t\t\t\t`' + properties.join('`, `') + '`.@You may deactivate or disable the ' + packageName + '-package\n\t\t\t\tto fix that issue.');
			}
		}
		statcon = Math.max(statcon, 3);
	}

	switch (statcon) {
		case 1:
			messages.push('The editorconfig was applied successfully and the editor for this file\n\t\t\tshould work as expected. If you face any unexpected behavior please report us the issue.\n\t\t\t♥️');
			break;
		case 0:
			messages.push('For this file were no editorconfig-settings applied.');
			break;
		default:
			break;
	}

	// Apply changes
	ecfg.messages = messages;
	ecfg.state = STATES[statcon];
	statusTile().update(ecfg.state);
}

// Reapplies the whole editorconfig to **all** open TextEditor-instances
function reapplyEditorconfig() {
	var textEditors = atom.workspace.getTextEditors();
	for (var index in textEditors) {
		// eslint-disable-line guard-for-in
		observeTextEditor(textEditors[index]);
	}
}

// Reapplies the settings immediately after changing the focus to a new pane
function observeActivePaneItem(editor) {
	if (editor && editor.constructor.name === 'TextEditor') {
		if (editor.getBuffer().editorconfig) {
			editor.getBuffer().editorconfig.applySettings();
		}
	} else {
		statusTile().update('subtle');
	}
}

// Initializes the (into the TextBuffer-instance) embedded editorconfig-object
function initializeTextBuffer(buffer) {
	if ('editorconfig' in buffer === false) {
		buffer.editorconfig = {
			buffer: buffer, // preserving a reference to the parent TextBuffer
			state: 'subtle',
			settings: {
				trim_trailing_whitespace: 'auto', // eslint-disable-line camelcase
				insert_final_newline: 'auto', // eslint-disable-line camelcase
				end_of_line: 'auto', // eslint-disable-line camelcase
				indent_style: 'auto', // eslint-disable-line camelcase
				tab_width: 'auto', // eslint-disable-line camelcase
				charset: 'auto' // eslint-disable-line camelcase
			},

			// Applies the settings to the buffer and the corresponding editor
			applySettings: function applySettings() {
				var editor = atom.workspace.getActiveTextEditor();
				var settings = this.settings;

				if (editor && editor.getBuffer() === buffer) {
					if (settings.indent_style !== 'auto') {
						editor.setSoftTabs(settings.indent_style === 'space');
					}
					if (settings.tab_width !== 'auto') {
						editor.setTabLength(settings.tab_width);
					}
					if (settings.end_of_line !== 'auto') {
						buffer.setPreferredLineEnding(settings.end_of_line);
					}
					if (settings.charset !== 'auto') {
						buffer.setEncoding(settings.charset);
					}
				}
				setState(this);
			},

			// onWillSave-Event-Handler
			// Trims whitespaces and inserts/strips final newline before saving
			onWillSave: function onWillSave() {
				var settings = this.settings;
				var finalText = undefined;
				var getText = function getText() {
					return finalText || buffer.getText();
				};

				if (settings.trim_trailing_whitespace === true) {
					finalText = getText().replace(/([ \t]+)$/gm, '');
				}

				if (settings.insert_final_newline !== 'auto') {
					if (settings.insert_final_newline) {
						var eol = '\n';
						if (settings.end_of_line !== 'auto') {
							eol = settings.end_of_line;
						}
						finalText = getText().replace(/[\n\r]+$/g, '').concat(eol);
					} else {
						while (getText().length > 0 && getText().charAt(getText().length - 1).search(/\r|\n/) > -1) {
							finalText = getText().slice(0, -1);
						}
					}
				}

				if (finalText !== undefined) {
					// Preserve cursor-position of active editor
					var preservedPosition = undefined;
					var activeTextEditor = atom.workspace.getActiveTextEditor();
					if (activeTextEditor) {
						preservedPosition = activeTextEditor.getCursorBufferPosition();
					}

					buffer.setTextInRange(buffer.getRange(), finalText, {
						normalizeLineEndings: false,
						undo: 'skip'
					});

					if (preservedPosition && activeTextEditor && activeTextEditor.getBuffer() === buffer) {
						var row = Math.min(preservedPosition.row, buffer.getLineCount() - 1);
						var column = Math.min(preservedPosition.column, buffer.lineLengthForRow(row));
						activeTextEditor.setCursorBufferPosition([row, column]);
					}
				}
			}
		};

		buffer.onWillSave(buffer.editorconfig.onWillSave.bind(buffer.editorconfig));
		if (buffer.getUri() && buffer.getUri().match(/[\\|\/]\.editorconfig$/g) !== null) {
			buffer.onDidSave(reapplyEditorconfig);
		}
	}
}

// Reveal and apply the editorconfig for the given TextEditor-instance
function observeTextEditor(editor) {
	if (!editor) {
		return;
	}
	initializeTextBuffer(editor.getBuffer());

	var file = editor.getURI();
	if (!file) {
		editor.onDidSave(function () {
			observeTextEditor(editor);
		});
		return;
	}

	editorconfig().parse(file).then(function (config) {
		if (Object.keys(config).length === 0) {
			return;
		}

		var ecfg = editor.getBuffer().editorconfig;
		var settings = ecfg.settings;
		var lineEndings = {
			crlf: '\r\n',
			cr: '\r',
			lf: '\n'
		};

		// Preserve evaluated Editorconfig
		ecfg.config = config;

		// Carefully normalize and initialize config-settings
		// eslint-disable-next-line camelcase
		settings.trim_trailing_whitespace = 'trim_trailing_whitespace' in config && typeof config.trim_trailing_whitespace === 'boolean' ? config.trim_trailing_whitespace === true : 'auto';

		// eslint-disable-next-line camelcase
		settings.insert_final_newline = 'insert_final_newline' in config && typeof config.insert_final_newline === 'boolean' ? config.insert_final_newline === true : 'auto';

		// eslint-disable-next-line camelcase
		settings.indent_style = 'indent_style' in config && config.indent_style.search(/^(space|tab)$/) > -1 ? config.indent_style : 'auto';

		// eslint-disable-next-line camelcase
		settings.end_of_line = lineEndings[config.end_of_line] || 'auto';

		// eslint-disable-next-line camelcase
		settings.tab_width = parseInt(config.indent_size || config.tab_width, 10);
		if (isNaN(settings.tab_width)) {
			settings.tab_width = 'auto'; // eslint-disable-line camelcase
		}

		settings.charset = 'charset' in config ? config.charset.replace(/-/g, '').toLowerCase() : 'auto';

		// Apply initially
		ecfg.applySettings();
	})['catch'](Error, function (e) {
		console.warn('atom-editorconfig: ' + e);
	});
}

// Hook into the events to recognize the user opening new editors or changing the pane
var activate = function activate() {
	(0, _commandsGenerate2['default'])();
	atom.workspace.observeTextEditors(observeTextEditor);
	atom.workspace.observeActivePaneItem(observeActivePaneItem);
};

// Apply the statusbar icon
var consumeStatusBar = function consumeStatusBar(statusBar) {
	statusBar.addRightTile({
		item: statusTile().create(),
		priority: 999
	});
};

exports['default'] = { activate: activate, consumeStatusBar: consumeStatusBar };
module.exports = exports['default'];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL3N0ZWZhbm8vLmF0b20vcGFja2FnZXMvZWRpdG9yY29uZmlnL2luZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2dDQUMyQixxQkFBcUI7Ozs7QUFFaEQsSUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLFVBQVUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDOztBQUU3QyxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsdUJBQXVCLENBQUMsQ0FBQztBQUNwRCxJQUFNLFlBQVksR0FBRyxPQUFPLENBQUMsY0FBYyxDQUFDLENBQUM7O0FBRTdDLElBQU0sTUFBTSxHQUFHLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFDOzs7O0FBSWpFLElBQU0sb0JBQW9CLEdBQUc7QUFDNUIsV0FBVSxFQUFFLENBQUMsc0JBQXNCLEVBQUUsMEJBQTBCLENBQUM7Q0FDaEUsQ0FBQzs7OztBQUlGLFNBQVMsUUFBUSxDQUFDLElBQUksRUFBRTtBQUN2QixLQUFNLFFBQVEsR0FBRyxFQUFFLENBQUM7QUFDcEIsS0FBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDOzs7QUFHaEIsS0FBSSxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFLO0FBQ3JELFNBQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDO0VBQzlDLEVBQUUsS0FBSyxDQUFDLEVBQUU7QUFDVixTQUFPLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFDLENBQUM7RUFDL0I7OztBQUdELEtBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxZQUFZLEtBQUssTUFBTSxJQUN4QyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FBQyxLQUFLLE1BQU0sRUFB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U0FBUyxDQUFDLHFCQUFxQixDQUFDLHFCQUFxQixDQUFDLENBQUM7Q0FDNUQsQ0FBQzs7O0FBR0YsSUFBTSxnQkFBZ0IsR0FBRyxTQUFuQixnQkFBZ0IsQ0FBRyxTQUFTLEVBQUk7QUFDckMsVUFBUyxDQUFDLFlBQVksQ0FBQztBQUN0QixNQUFJLEVBQUUsVUFBVSxFQUFFLENBQUMsTUFBTSxFQUFFO0FBQzNCLFVBQVEsRUFBRSxHQUFHO0VBQ2IsQ0FBQyxDQUFDO0NBQ0gsQ0FBQzs7cUJBRWEsRUFBQyxRQUFRLEVBQVIsUUFBUSxFQUFFLGdCQUFnQixFQUFoQixnQkFBZ0IsRUFBQyIsImZpbGUiOiIvaG9tZS9zdGVmYW5vLy5hdG9tL3BhY2thZ2VzL2VkaXRvcmNvbmZpZy9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAYmFiZWwgKi9cbmltcG9ydCBnZW5lcmF0ZUNvbmZpZyBmcm9tICcuL2NvbW1hbmRzL2dlbmVyYXRlJztcblxuY29uc3QgbGF6eVJlcSA9IHJlcXVpcmUoJ2xhenktcmVxJykocmVxdWlyZSk7XG5cbmNvbnN0IHN0YXR1c1RpbGUgPSBsYXp5UmVxKCcuL2xpYi9zdGF0dXN0aWxlLXZpZXcnKTtcbmNvbnN0IGVkaXRvcmNvbmZpZyA9IGxhenlSZXEoJ2VkaXRvcmNvbmZpZycpO1xuXG5jb25zdCBTVEFURVMgPSBbJ3N1YnRsZScsICdzdWNjZXNzJywgJ2luZm8nLCAnd2FybmluZycsICdlcnJvciddO1xuXG4vLyBIb2xkcyBhbGwgKipibGFja2xpc3RlZCoqIHBhY2thZ2VzIGFuZCB0aGUgcHJvcGVydGllcyB3ZSBhc3N1bWUgYXJlIGFmZmVjdGVkIGJ5IHRoZW1cbi8vICdwYWNrYWdlbmFtZSc6IFtwcm9wZXJ0aWVzXVxuY29uc3QgQkxBQ0tMSVNURURfUEFDS0FHRVMgPSB7XG5cdHdoaXRlc3BhY2U6IFsnaW5zZXJ0X2ZpbmFsX25ld2xpbmUnLCAndHJpbV90cmFpbGluZ193aGl0ZXNwYWNlJ11cbn07XG5cbi8vIFNldHMgdGhlIHN0YXRlIG9mIHRoZSBlbWJlZGRlZCBlZGl0b3Jjb25maWdcbi8vIFRoaXMgaW5jbHVkZXMgdGhlIHNldmVyaXR5IChpbmZvLCB3YXJuaW5nLi4pIGFzIHdlbGwgYXMgdGhlIG5vdGlmaWNhdGlvbi1tZXNzYWdlcyBmb3IgdXNlcnNcbmZ1bmN0aW9uIHNldFN0YXRlKGVjZmcpIHtcblx0Y29uc3QgbWVzc2FnZXMgPSBbXTtcblx0bGV0IHN0YXRjb24gPSAwO1xuXG5cdC8vIENoZWNrIGlmIGFueSBlZGl0b3Jjb25maWctc2V0dGluZyBpcyBpbiB1c2Vcblx0aWYgKE9iamVjdC5rZXlzKGVjZmcuc2V0dGluZ3MpLnJlZHVjZSgocHJldiwgY3VycikgPT4ge1xuXHRcdHJldHVybiBlY2ZnLnNldHRpbmdzW2N1cnJdICE9PSAnYXV0bycgfHwgcHJldjtcblx0fSwgZmFsc2UpKSB7XG5cdFx0c3RhdGNvbiA9IE1hdGgubWF4KHN0YXRjb24sIDEpO1xuXHR9XG5cblx0Ly8gQ2hlY2sgdGhlICdUYWIgVHlwZSctc2V0dGluZ1xuXHRpZiAoZWNmZy5zZXR0aW5ncy5pbmRlbnRfc3R5bGUgIT09ICdhdXRvJyAmJlxuXHRcdGF0b20uY29uZmlnLmdldCgnZWRpdG9yLnRhYlR5cGUnKSAhPT0gJ2F1dG8nKSB7XG5cdFx0Y29uc3QgdGFiVHlwZSA9IGF0b20uY29uZmlnLmdldCgnZWRpdG9yLnRhYlR5cGUnKTtcblxuXHRcdG1lc3NhZ2VzLnB1c2goYCoqVGFiIFR5cGU6KiogWW91IGVkaXRvcidzIGNvbmZpZ3VyYXRpb24gc2V0dGluZyBcIlRhYiBUeXBlXCJcblx0XHQoY3VycmVudGx5IFwiJHt0YWJUeXBlfVwiIHByZXZlbnRzIHRoZSBlZGl0b3Jjb25maWctcHJvcGVydHkgXFxgaW5kZW50X3N0eWxlXFxgIGZyb20gd29ya2luZy5cblx0XHRAXCJUYWIgVHlwZVwiICoqbXVzdCoqIGJlIHNldCB0byBcImF1dG9cIiB0byBmaXggdGhpcyBpc3N1ZS5gKTtcblxuXHRcdHN0YXRjb24gPSBNYXRoLm1heChzdGF0Y29uLCA0KTtcblx0fVxuXG5cdC8vIENoZWNrIGZvciBCTEFDS0xJU1RFRCBwYWNrYWdlc1xuXHRjb25zdCBzdXNwaWNpdW91c1BhY2thZ2VzID0ge307XG5cdGxldCBhZmZlY3RlZFByb3BlcnRpZXM7XG5cdGZvciAoY29uc3QgcGFja2FnZU5hbWUgaW4gQkxBQ0tMSVNURURfUEFDS0FHRVMpIHtcblx0XHRpZiAoe30uaGFzT3duUHJvcGVydHkuY2FsbChCTEFDS0xJU1RFRF9QQUNLQUdFUywgcGFja2FnZU5hbWUpKSB7XG5cdFx0XHRhZmZlY3RlZFByb3BlcnRpZXMgPSBCTEFDS0xJU1RFRF9QQUNLQUdFU1twYWNrYWdlTmFtZV0uZmlsdGVyKHByb3AgPT4ge1xuXHRcdFx0XHRyZXR1cm4gZWNmZy5zZXR0aW5nc1twcm9wXSAhPT0gJ2F1dG8nO1xuXHRcdFx0fSk7XG5cdFx0XHRpZiAoYWZmZWN0ZWRQcm9wZXJ0aWVzLmxlbmd0aCA+IDAgJiZcblx0XHRcdFx0YXRvbS5wYWNrYWdlcy5pc1BhY2thZ2VBY3RpdmUocGFja2FnZU5hbWUpKSB7XG5cdFx0XHRcdHN1c3BpY2l1b3VzUGFja2FnZXNbcGFja2FnZU5hbWVdID0gYWZmZWN0ZWRQcm9wZXJ0aWVzO1xuXHRcdFx0fVxuXHRcdH1cblx0fVxuXHRpZiAoT2JqZWN0LmtleXMoc3VzcGljaXVvdXNQYWNrYWdlcykubGVuZ3RoID4gMCkge1xuXHRcdGZvciAoY29uc3QgcGFja2FnZU5hbWUgaW4gc3VzcGljaXVvdXNQYWNrYWdlcykge1xuXHRcdFx0aWYgKHt9Lmhhc093blByb3BlcnR5LmNhbGwoc3VzcGljaXVvdXNQYWNrYWdlcywgcGFja2FnZU5hbWUpKSB7XG5cdFx0XHRcdGNvbnN0IHByb3BlcnRpZXMgPSBzdXNwaWNpdW91c1BhY2thZ2VzW3BhY2thZ2VOYW1lXTtcblx0XHRcdFx0bWVzc2FnZXMucHVzaChgKioke3BhY2thZ2VOYW1lfToqKiBJdCBpcyBsaWtlbHkgdGhhdCB0aGVcblx0XHRcdFx0JHtwYWNrYWdlTmFtZX0tcGFja2FnZSBwcmV2ZW50cyB0aGUgZm9sbG93aW5nXG5cdFx0XHRcdHByb3BlcnQke3Byb3BlcnRpZXMubGVuZ3RoID4gMSA/ICdpZXMnIDogJ3knfSBmcm9tIHdvcmtpbmcgcmVsaWFibHk6XG5cdFx0XHRcdFxcYCR7cHJvcGVydGllcy5qb2luKCdgLCBgJyl9XFxgLkBZb3UgbWF5IGRlYWN0aXZhdGUgb3IgZGlzYWJsZSB0aGUgJHtwYWNrYWdlTmFtZX0tcGFja2FnZVxuXHRcdFx0XHR0byBmaXggdGhhdCBpc3N1ZS5gKTtcblx0XHRcdH1cblx0XHR9XG5cdFx0c3RhdGNvbiA9IE1hdGgubWF4KHN0YXRjb24sIDMpO1xuXHR9XG5cblx0c3dpdGNoIChzdGF0Y29uKSB7XG5cdFx0Y2FzZSAxOlxuXHRcdFx0bWVzc2FnZXMucHVzaChgVGhlIGVkaXRvcmNvbmZpZyB3YXMgYXBwbGllZCBzdWNjZXNzZnVsbHkgYW5kIHRoZSBlZGl0b3IgZm9yIHRoaXMgZmlsZVxuXHRcdFx0c2hvdWxkIHdvcmsgYXMgZXhwZWN0ZWQuIElmIHlvdSBmYWNlIGFueSB1bmV4cGVjdGVkIGJlaGF2aW9yIHBsZWFzZSByZXBvcnQgdXMgdGhlIGlzc3VlLlxuXHRcdFx04pml77iPYCk7XG5cdFx0XHRicmVhaztcblx0XHRjYXNlIDA6XG5cdFx0XHRtZXNzYWdlcy5wdXNoKGBGb3IgdGhpcyBmaWxlIHdlcmUgbm8gZWRpdG9yY29uZmlnLXNldHRpbmdzIGFwcGxpZWQuYCk7XG5cdFx0XHRicmVhaztcblx0XHRkZWZhdWx0OlxuXHRcdFx0YnJlYWs7XG5cdH1cblxuXHQvLyBBcHBseSBjaGFuZ2VzXG5cdGVjZmcubWVzc2FnZXMgPSBtZXNzYWdlcztcblx0ZWNmZy5zdGF0ZSA9IFNUQVRFU1tzdGF0Y29uXTtcblx0c3RhdHVzVGlsZSgpLnVwZGF0ZShlY2ZnLnN0YXRlKTtcbn1cblxuLy8gUmVhcHBsaWVzIHRoZSB3aG9sZSBlZGl0b3Jjb25maWcgdG8gKiphbGwqKiBvcGVuIFRleHRFZGl0b3ItaW5zdGFuY2VzXG5mdW5jdGlvbiByZWFwcGx5RWRpdG9yY29uZmlnKCkge1xuXHRjb25zdCB0ZXh0RWRpdG9ycyA9IGF0b20ud29ya3NwYWNlLmdldFRleHRFZGl0b3JzKCk7XG5cdGZvciAoY29uc3QgaW5kZXggaW4gdGV4dEVkaXRvcnMpIHsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBndWFyZC1mb3ItaW5cblx0XHRvYnNlcnZlVGV4dEVkaXRvcih0ZXh0RWRpdG9yc1tpbmRleF0pO1xuXHR9XG59XG5cbi8vIFJlYXBwbGllcyB0aGUgc2V0dGluZ3MgaW1tZWRpYXRlbHkgYWZ0ZXIgY2hhbmdpbmcgdGhlIGZvY3VzIHRvIGEgbmV3IHBhbmVcbmZ1bmN0aW9uIG9ic2VydmVBY3RpdmVQYW5lSXRlbShlZGl0b3IpIHtcblx0aWYgKGVkaXRvciAmJiBlZGl0b3IuY29uc3RydWN0b3IubmFtZSA9PT0gJ1RleHRFZGl0b3InKSB7XG5cdFx0aWYgKGVkaXRvci5nZXRCdWZmZXIoKS5lZGl0b3Jjb25maWcpIHtcblx0XHRcdGVkaXRvci5nZXRCdWZmZXIoKS5lZGl0b3Jjb25maWcuYXBwbHlTZXR0aW5ncygpO1xuXHRcdH1cblx0fSBlbHNlIHtcblx0XHRzdGF0dXNUaWxlKCkudXBkYXRlKCdzdWJ0bGUnKTtcblx0fVxufVxuXG4vLyBJbml0aWFsaXplcyB0aGUgKGludG8gdGhlIFRleHRCdWZmZXItaW5zdGFuY2UpIGVtYmVkZGVkIGVkaXRvcmNvbmZpZy1vYmplY3RcbmZ1bmN0aW9uIGluaXRpYWxpemVUZXh0QnVmZmVyKGJ1ZmZlcikge1xuXHRpZiAoJ2VkaXRvcmNvbmZpZycgaW4gYnVmZmVyID09PSBmYWxzZSkge1xuXHRcdGJ1ZmZlci5lZGl0b3Jjb25maWcgPSB7XG5cdFx0XHRidWZmZXIsIC8vIHByZXNlcnZpbmcgYSByZWZlcmVuY2UgdG8gdGhlIHBhcmVudCBUZXh0QnVmZmVyXG5cdFx0XHRzdGF0ZTogJ3N1YnRsZScsXG5cdFx0XHRzZXR0aW5nczoge1xuXHRcdFx0XHR0cmltX3RyYWlsaW5nX3doaXRlc3BhY2U6ICdhdXRvJywgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRcdFx0aW5zZXJ0X2ZpbmFsX25ld2xpbmU6ICdhdXRvJywgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRcdFx0ZW5kX29mX2xpbmU6ICdhdXRvJywgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRcdFx0aW5kZW50X3N0eWxlOiAnYXV0bycsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0XHRcdHRhYl93aWR0aDogJ2F1dG8nLCAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIGNhbWVsY2FzZVxuXHRcdFx0XHRjaGFyc2V0OiAnYXV0bycgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHRcdH0sXG5cblx0XHRcdC8vIEFwcGxpZXMgdGhlIHNldHRpbmdzIHRvIHRoZSBidWZmZXIgYW5kIHRoZSBjb3JyZXNwb25kaW5nIGVkaXRvclxuXHRcdFx0YXBwbHlTZXR0aW5ncygpIHtcblx0XHRcdFx0Y29uc3QgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpO1xuXHRcdFx0XHRjb25zdCBzZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3M7XG5cblx0XHRcdFx0aWYgKGVkaXRvciAmJiBlZGl0b3IuZ2V0QnVmZmVyKCkgPT09IGJ1ZmZlcikge1xuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy5pbmRlbnRfc3R5bGUgIT09ICdhdXRvJykge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNldFNvZnRUYWJzKHNldHRpbmdzLmluZGVudF9zdHlsZSA9PT0gJ3NwYWNlJyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmIChzZXR0aW5ncy50YWJfd2lkdGggIT09ICdhdXRvJykge1xuXHRcdFx0XHRcdFx0ZWRpdG9yLnNldFRhYkxlbmd0aChzZXR0aW5ncy50YWJfd2lkdGgpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuZW5kX29mX2xpbmUgIT09ICdhdXRvJykge1xuXHRcdFx0XHRcdFx0YnVmZmVyLnNldFByZWZlcnJlZExpbmVFbmRpbmcoc2V0dGluZ3MuZW5kX29mX2xpbmUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuY2hhcnNldCAhPT0gJ2F1dG8nKSB7XG5cdFx0XHRcdFx0XHRidWZmZXIuc2V0RW5jb2Rpbmcoc2V0dGluZ3MuY2hhcnNldCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHNldFN0YXRlKHRoaXMpO1xuXHRcdFx0fSxcblxuXHRcdFx0Ly8gb25XaWxsU2F2ZS1FdmVudC1IYW5kbGVyXG5cdFx0XHQvLyBUcmltcyB3aGl0ZXNwYWNlcyBhbmQgaW5zZXJ0cy9zdHJpcHMgZmluYWwgbmV3bGluZSBiZWZvcmUgc2F2aW5nXG5cdFx0XHRvbldpbGxTYXZlKCkge1xuXHRcdFx0XHRjb25zdCBzZXR0aW5ncyA9IHRoaXMuc2V0dGluZ3M7XG5cdFx0XHRcdGxldCBmaW5hbFRleHQ7XG5cdFx0XHRcdGNvbnN0IGdldFRleHQgPSAoKSA9PiB7XG5cdFx0XHRcdFx0cmV0dXJuIGZpbmFsVGV4dCB8fCBidWZmZXIuZ2V0VGV4dCgpO1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRcdGlmIChzZXR0aW5ncy50cmltX3RyYWlsaW5nX3doaXRlc3BhY2UgPT09IHRydWUpIHtcblx0XHRcdFx0XHRmaW5hbFRleHQgPSBnZXRUZXh0KCkucmVwbGFjZSgvKFsgXFx0XSspJC9nbSwgJycpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHNldHRpbmdzLmluc2VydF9maW5hbF9uZXdsaW5lICE9PSAnYXV0bycpIHtcblx0XHRcdFx0XHRpZiAoc2V0dGluZ3MuaW5zZXJ0X2ZpbmFsX25ld2xpbmUpIHtcblx0XHRcdFx0XHRcdGxldCBlb2wgPSAnXFxuJztcblx0XHRcdFx0XHRcdGlmIChzZXR0aW5ncy5lbmRfb2ZfbGluZSAhPT0gJ2F1dG8nKSB7XG5cdFx0XHRcdFx0XHRcdGVvbCA9IHNldHRpbmdzLmVuZF9vZl9saW5lO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0ZmluYWxUZXh0ID0gZ2V0VGV4dCgpLnJlcGxhY2UoL1tcXG5cXHJdKyQvZywgJycpLmNvbmNhdChlb2wpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR3aGlsZSAoZ2V0VGV4dCgpLmxlbmd0aCA+IDAgJiZcblx0XHRcdFx0XHRcdFx0XHRnZXRUZXh0KCkuY2hhckF0KGdldFRleHQoKS5sZW5ndGggLSAxKS5zZWFyY2goL1xccnxcXG4vKSA+IC0xKSB7XG5cdFx0XHRcdFx0XHRcdGZpbmFsVGV4dCA9IGdldFRleHQoKS5zbGljZSgwLCAtMSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGZpbmFsVGV4dCAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdFx0Ly8gUHJlc2VydmUgY3Vyc29yLXBvc2l0aW9uIG9mIGFjdGl2ZSBlZGl0b3Jcblx0XHRcdFx0XHRsZXQgcHJlc2VydmVkUG9zaXRpb247XG5cdFx0XHRcdFx0Y29uc3QgYWN0aXZlVGV4dEVkaXRvciA9IGF0b20ud29ya3NwYWNlLmdldEFjdGl2ZVRleHRFZGl0b3IoKTtcblx0XHRcdFx0XHRpZiAoYWN0aXZlVGV4dEVkaXRvcikge1xuXHRcdFx0XHRcdFx0cHJlc2VydmVkUG9zaXRpb24gPSBhY3RpdmVUZXh0RWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnVmZmVyLnNldFRleHRJblJhbmdlKGJ1ZmZlci5nZXRSYW5nZSgpLCBmaW5hbFRleHQsIHtcblx0XHRcdFx0XHRcdG5vcm1hbGl6ZUxpbmVFbmRpbmdzOiBmYWxzZSxcblx0XHRcdFx0XHRcdHVuZG86ICdza2lwJ1xuXHRcdFx0XHRcdH0pO1xuXG5cdFx0XHRcdFx0aWYgKHByZXNlcnZlZFBvc2l0aW9uICYmXG5cdFx0XHRcdFx0XHRhY3RpdmVUZXh0RWRpdG9yICYmXG5cdFx0XHRcdFx0XHRhY3RpdmVUZXh0RWRpdG9yLmdldEJ1ZmZlcigpID09PSBidWZmZXIpIHtcblx0XHRcdFx0XHRcdGNvbnN0IHJvdyA9IE1hdGgubWluKHByZXNlcnZlZFBvc2l0aW9uLnJvdywgYnVmZmVyLmdldExpbmVDb3VudCgpIC0gMSk7XG5cdFx0XHRcdFx0XHRjb25zdCBjb2x1bW4gPSBNYXRoLm1pbihwcmVzZXJ2ZWRQb3NpdGlvbi5jb2x1bW4sIGJ1ZmZlci5saW5lTGVuZ3RoRm9yUm93KHJvdykpO1xuXHRcdFx0XHRcdFx0YWN0aXZlVGV4dEVkaXRvci5zZXRDdXJzb3JCdWZmZXJQb3NpdGlvbihbcm93LCBjb2x1bW5dKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0YnVmZmVyLm9uV2lsbFNhdmUoYnVmZmVyLmVkaXRvcmNvbmZpZy5vbldpbGxTYXZlLmJpbmQoYnVmZmVyLmVkaXRvcmNvbmZpZykpO1xuXHRcdGlmIChidWZmZXIuZ2V0VXJpKCkgJiYgYnVmZmVyLmdldFVyaSgpLm1hdGNoKC9bXFxcXHxcXC9dXFwuZWRpdG9yY29uZmlnJC9nKSAhPT0gbnVsbCkge1xuXHRcdFx0YnVmZmVyLm9uRGlkU2F2ZShyZWFwcGx5RWRpdG9yY29uZmlnKTtcblx0XHR9XG5cdH1cbn1cblxuLy8gUmV2ZWFsIGFuZCBhcHBseSB0aGUgZWRpdG9yY29uZmlnIGZvciB0aGUgZ2l2ZW4gVGV4dEVkaXRvci1pbnN0YW5jZVxuZnVuY3Rpb24gb2JzZXJ2ZVRleHRFZGl0b3IoZWRpdG9yKSB7XG5cdGlmICghZWRpdG9yKSB7XG5cdFx0cmV0dXJuO1xuXHR9XG5cdGluaXRpYWxpemVUZXh0QnVmZmVyKGVkaXRvci5nZXRCdWZmZXIoKSk7XG5cblx0Y29uc3QgZmlsZSA9IGVkaXRvci5nZXRVUkkoKTtcblx0aWYgKCFmaWxlKSB7XG5cdFx0ZWRpdG9yLm9uRGlkU2F2ZSgoKSA9PiB7XG5cdFx0XHRvYnNlcnZlVGV4dEVkaXRvcihlZGl0b3IpO1xuXHRcdH0pO1xuXHRcdHJldHVybjtcblx0fVxuXG5cdGVkaXRvcmNvbmZpZygpLnBhcnNlKGZpbGUpLnRoZW4oY29uZmlnID0+IHtcblx0XHRpZiAoT2JqZWN0LmtleXMoY29uZmlnKS5sZW5ndGggPT09IDApIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRjb25zdCBlY2ZnID0gZWRpdG9yLmdldEJ1ZmZlcigpLmVkaXRvcmNvbmZpZztcblx0XHRjb25zdCBzZXR0aW5ncyA9IGVjZmcuc2V0dGluZ3M7XG5cdFx0Y29uc3QgbGluZUVuZGluZ3MgPSB7XG5cdFx0XHRjcmxmOiAnXFxyXFxuJyxcblx0XHRcdGNyOiAnXFxyJyxcblx0XHRcdGxmOiAnXFxuJ1xuXHRcdH07XG5cblx0XHQvLyBQcmVzZXJ2ZSBldmFsdWF0ZWQgRWRpdG9yY29uZmlnXG5cdFx0ZWNmZy5jb25maWcgPSBjb25maWc7XG5cblx0XHQvLyBDYXJlZnVsbHkgbm9ybWFsaXplIGFuZCBpbml0aWFsaXplIGNvbmZpZy1zZXR0aW5nc1xuXHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2Vcblx0XHRzZXR0aW5ncy50cmltX3RyYWlsaW5nX3doaXRlc3BhY2UgPSAoJ3RyaW1fdHJhaWxpbmdfd2hpdGVzcGFjZScgaW4gY29uZmlnKSAmJlxuXHRcdFx0dHlwZW9mIGNvbmZpZy50cmltX3RyYWlsaW5nX3doaXRlc3BhY2UgPT09ICdib29sZWFuJyA/XG5cdFx0XHRjb25maWcudHJpbV90cmFpbGluZ193aGl0ZXNwYWNlID09PSB0cnVlIDpcblx0XHRcdCdhdXRvJztcblxuXHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2Vcblx0XHRzZXR0aW5ncy5pbnNlcnRfZmluYWxfbmV3bGluZSA9ICgnaW5zZXJ0X2ZpbmFsX25ld2xpbmUnIGluIGNvbmZpZykgJiZcblx0XHRcdHR5cGVvZiBjb25maWcuaW5zZXJ0X2ZpbmFsX25ld2xpbmUgPT09ICdib29sZWFuJyA/XG5cdFx0XHRjb25maWcuaW5zZXJ0X2ZpbmFsX25ld2xpbmUgPT09IHRydWUgOlxuXHRcdFx0J2F1dG8nO1xuXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuXHRcdHNldHRpbmdzLmluZGVudF9zdHlsZSA9ICgoJ2luZGVudF9zdHlsZScgaW4gY29uZmlnKSAmJlxuXHRcdFx0Y29uZmlnLmluZGVudF9zdHlsZS5zZWFyY2goL14oc3BhY2V8dGFiKSQvKSA+IC0xKSA/XG5cdFx0XHRjb25maWcuaW5kZW50X3N0eWxlIDpcblx0XHRcdCdhdXRvJztcblxuXHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjYW1lbGNhc2Vcblx0XHRzZXR0aW5ncy5lbmRfb2ZfbGluZSA9IGxpbmVFbmRpbmdzW2NvbmZpZy5lbmRfb2ZfbGluZV0gfHwgJ2F1dG8nO1xuXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGNhbWVsY2FzZVxuXHRcdHNldHRpbmdzLnRhYl93aWR0aCA9IHBhcnNlSW50KGNvbmZpZy5pbmRlbnRfc2l6ZSB8fCBjb25maWcudGFiX3dpZHRoLCAxMCk7XG5cdFx0aWYgKGlzTmFOKHNldHRpbmdzLnRhYl93aWR0aCkpIHtcblx0XHRcdHNldHRpbmdzLnRhYl93aWR0aCA9ICdhdXRvJzsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBjYW1lbGNhc2Vcblx0XHR9XG5cblx0XHRzZXR0aW5ncy5jaGFyc2V0ID0gKCdjaGFyc2V0JyBpbiBjb25maWcpID9cblx0XHRcdGNvbmZpZy5jaGFyc2V0LnJlcGxhY2UoLy0vZywgJycpLnRvTG93ZXJDYXNlKCkgOlxuXHRcdFx0J2F1dG8nO1xuXG5cdFx0Ly8gQXBwbHkgaW5pdGlhbGx5XG5cdFx0ZWNmZy5hcHBseVNldHRpbmdzKCk7XG5cdH0pLmNhdGNoKEVycm9yLCBlID0+IHtcblx0XHRjb25zb2xlLndhcm4oYGF0b20tZWRpdG9yY29uZmlnOiAke2V9YCk7XG5cdH0pO1xufVxuXG4vLyBIb29rIGludG8gdGhlIGV2ZW50cyB0byByZWNvZ25pemUgdGhlIHVzZXIgb3BlbmluZyBuZXcgZWRpdG9ycyBvciBjaGFuZ2luZyB0aGUgcGFuZVxuY29uc3QgYWN0aXZhdGUgPSAoKSA9PiB7XG5cdGdlbmVyYXRlQ29uZmlnKCk7XG5cdGF0b20ud29ya3NwYWNlLm9ic2VydmVUZXh0RWRpdG9ycyhvYnNlcnZlVGV4dEVkaXRvcik7XG5cdGF0b20ud29ya3NwYWNlLm9ic2VydmVBY3RpdmVQYW5lSXRlbShvYnNlcnZlQWN0aXZlUGFuZUl0ZW0pO1xufTtcblxuLy8gQXBwbHkgdGhlIHN0YXR1c2JhciBpY29uXG5jb25zdCBjb25zdW1lU3RhdHVzQmFyID0gc3RhdHVzQmFyID0+IHtcblx0c3RhdHVzQmFyLmFkZFJpZ2h0VGlsZSh7XG5cdFx0aXRlbTogc3RhdHVzVGlsZSgpLmNyZWF0ZSgpLFxuXHRcdHByaW9yaXR5OiA5OTlcblx0fSk7XG59O1xuXG5leHBvcnQgZGVmYXVsdCB7YWN0aXZhdGUsIGNvbnN1bWVTdGF0dXNCYXJ9O1xuIl19
//# sourceURL=/home/stefano/.atom/packages/editorconfig/index.js
